var PhenoTips=function(e){return(e.widgets=e.widgets||{}).DropDown=Class.create({options:{},initialize:function(e){this.element=e,this.hasForceOpen=!1;var t=e.next(".dropdown");t?(this.contentContainer=null,this.dropdown=t,this.hasForceOpen=!0):(this.dropdown=new Element("div",{class:"dropdown"}),this.contentContainer=new Element("div"),this.dropdown.update(this.contentContainer))},setContent:function(e){null!=this.contentContainer&&this.contentContainer.update(e)},show:function(e){return!(e&&!this.hasForceOpen||(this.dropdown.hasClassName("invisible")?this.dropdown.removeClassName("invisible"):this.element.insert({after:this.dropdown}),0))},close:function(e){return!(e&&!this.hasForceOpen||(this.dropdown.addClassName("invisible"),0))}}),e}((PhenoTips=function(e){return(e.widgets=e.widgets||{}).OntologyBrowser=Class.create({options:{script:XWiki.contextPath+"/rest/vocabularies/hpo/suggest?sort=nameSort asc&maxResults=10000&",json:!0,varname:"input",method:"get",responseFormat:"application/json",resultsParameter:"rows",resultId:"id",resultValue:"name",resultCategory:"term_category",resultParent:{selector:"parents",processingFunction:function(e){return{id:e.id,value:e.name_translated||e.name}}},noresults:"No sub-terms",showParents:!0,showRoot:!0,enableSelection:!0,enableBrowse:!0,isTermSelected:function(e){return!1},unselectTerm:function(e){},defaultEntryAction:"browse"},initialize:function(t,i,s){this.options=Object.extend(Object.clone(this.options),s||{}),this.suggest=t,this.loadingMessage=new Element("div",{class:"plainmessage loading"}).update("Loading…"),i?this.container=i:(this.container=new e.widgets.ModalPopup(this.loadingMessage,{},{idPrefix:"ontology-browser-window-",title:"Related terms",backgroundColor:"#ffffff",verticalPosition:"top",extraDialogClassName:"dialog-ontology-browser",removeOnClose:!0}),this.options.modal=!0),this._obrowserExpandEventHandler=this._obrowserExpandEventHandler.bindAsEventListener(this)},load:function(e){this.setContent(this.loadingMessage);var t=this.options.script+this.options.varname+"="+encodeURIComponent(e),i={};i.Accept=this.options.responseFormat,new Ajax.Request(t,{method:this.options.method,requestHeaders:i,onSuccess:function(t){this.setContent(this.buildTree(this._getDataFromResponse(t))),this.__crtRoot=e,this.container.content&&Event.fire(document,"xwiki:dom:updated",{elements:[this.container.contentContainer||this.container.content]})}.bind(this),onFailure:function(e){this.setContent("Failed to retrieve data: "+e.statusText),this.__crtRoot=""}.bind(this)})},expandTo:function(e,t){-1!=t.indexOf(this.__crtRoot)&&this._expandToStep(e,t.without(this.__crtRoot,e))},_expandToStep:function(e,t){var i=this;if(!this.container.contentContainer.down('li.entry input.select-tool[value="'+e.replace(/"/g,'\\"')+'"]')){var s=!1;t.each((function(n){if(!s){var o=i.container.contentContainer.down('li.entry input.select-tool[value="'+n.replace(/"/g,'\\"')+'"]');if(o){var a=o.up("li");!a.hasClassName("collapsed")&&a.down(".descendents")||(Event.observe(a,"obrowser:expand:finished",(function(s){Event.stopObserving(a,"obrowser:expand:finished"),i._expandToStep(e,t.without(n))})),i._toggleExpandState(a),s=!0)}}}))}},expand:function(e,t){var i=e.__termId,s={};i.match(/^HP:[0-9]+$/i)&&(s.customFilter="is_a:"+i.toUpperCase().replace(/:/g,"\\:"));var n=this.options.script+this.options.varname+"="+encodeURIComponent(i),o={};o.Accept=this.options.responseFormat,new Ajax.Request(n,{method:this.options.method,requestHeaders:o,parameters:s,onCreate:function(){this._lockExpandTool(e)}.bind(this),onSuccess:function(i){var s={};if(t){var n=this.buildDescendentsList(this._getDataFromResponse(i));e.insert({bottom:n}),Event.fire(document,"obrowser:content:added",{added:n,obrowser:this}),Event.fire(e,"obrowser:expand:finished"),Event.fire(this.container.contentContainer||document,"obrowser:expand:finished"),Event.fire(document,"xwiki:dom:updated",{elements:[n]})}else s.count=this.countDescendents(this._getDataFromResponse(i));if(0===s.count||t&&!e.down(".descendents .entry, .error")){e.addClassName("collapsed");var o=e.down(".expand-tool");o&&(o.update(this._getExpandCollapseSymbol(!0)).addClassName("disabled"),o.stopObserving("click"))}Event.fire(document,"ms:popup:content-updated",{popup:this.container})}.bind(this),onFailure:function(t){Event.fire(e,"obrowser:expand:failed",{data:new Element("div",{class:"error"}).update("Failed to retrieve data: "+t.statusText),count:-1})},onComplete:function(){this._unlockExpandTool(e)}.bind(this)})},_getDataFromResponse:function(e){return this.options.json?e.responseJSON:e.responseXML},_getResultset_json:function(e,t){return e&&e[t]||[]},_getResultFieldValue_json:function(e,t){return e&&(e[t+"_translated"]||e[t])||""},_getResultFieldValueAsArray_json:function(e,t){return new Array(e&&(e[t+"_translated"]||e[t])||"").flatten()},_getResultset_xml:function(e,t){return e&&e.getElementsByTagName(t)},_getResultFieldValue_xml:function(e,t){var i=e&&Element.down(e,t);return i&&i.firstChild&&i.firstChild.nodeValue||""},_getResultFieldValueAsArray_xml:function(e,t){var i=new Array;return e&&Element.select(e,t).each((function(e){var t=e.firstChild&&e.firstChild.nodeValue;t&&i.push(t)})),i},_getResultset:function(e,t){return this.options.json?this._getResultset_json(e,t):this._getResultset_xml(e,t)},_getResultFieldValue:function(e,t){return this.options.json?this._getResultFieldValue_json(e,t):this._getResultFieldValue_xml(e,t)},_getResultFieldValueAsArray:function(e,t){return this.options.json?this._getResultFieldValueAsArray_json(e,t):this._getResultFieldValueAsArray_xml(e,t)},buildTree:function(e){var t=this._getResultset(e,this.options.resultsParameter);if(0==t.length)return new Element("div",{class:"error"}).update(this.options.noresults);var i=t[0],s=new Element("div");if(this.options.showParents){var n=new Element("ul",{class:"parents"});this._getResultFieldValueAsArray(i,this.options.resultParent.selector).each(function(e){var t=e,i={};"function"==typeof this.options.resultParent.processingFunction&&(i=this.options.resultParent.processingFunction(t)),n.insert({bottom:this._createParentBranch(i)})}.bind(this)),n.hasChildNodes()&&s.insert({top:n}),Event.fire(document,"obrowser:content:added",{added:n,obrowser:this})}e={id:this._getResultFieldValue(i,this.options.resultId),value:this._getResultFieldValue(i,this.options.resultValue),category:this._generateEntryCategory(i)};var o=this._createRoot(e);return s.insert({bottom:o}),Event.fire(document,"obrowser:content:added",{added:o,obrowser:this}),s},countDescendents:function(e){return this._getResultset(e,this.options.resultsParameter).length},buildDescendentsList:function(e){for(var t=this._getResultset(e,this.options.resultsParameter),i=new Element("ul",{class:"descendents"}),s=0;s<t.length;s++){var n={id:this._getResultFieldValue(t[s],this.options.resultId),value:this._getResultFieldValue(t[s],this.options.resultValue),category:this._generateEntryCategory(t[s])};i.insert({bottom:this._createDescendentBranch(n)})}return i.hasChildNodes()?i:new Element("div",{class:"descendents hint empty"}).update(this.options.noresults)},_createBranch:function(e,t,i,s){var n=new Element(e,{class:"entry "+t});n.__termId=i.id,n.__termCategory=i.category;var o=new Element("div",{class:"entry-data"});o.insert({bottom:this._generateEntryTitle(i.id,i.value)});var a=new Element("span",{class:"entry-tools"});if(a.observe("click",(function(e){e.stop()})),o.insert({bottom:a}),n.update(o),this._isRootEntry(n)||"browse"==this.options.defaultEntryAction&&o.down(".info").observe("click",this._browseEntry.bindAsEventListener(this)),a.insert(new Element("span",{class:"fa fa-info-circle phenotype-info xHelpButton",title:i.id,"data-source":this.suggest&&this.suggest.fld&&this.suggest.fld.id})),this.options.enableSelection&&(n.__selectTool=new Element("input",{type:"checkbox",name:"term_selector",value:i.id,class:"select-tool"}),o.insert({top:n.__selectTool}),this.options.isTermSelected(n.__termId)&&(n.addClassName("accepted"),n.__selectTool.checked="checked"),n.__selectTool.observe("click",this._toggleEntrySelection.bindAsEventListener(this)),"select"==this.options.defaultEntryAction&&o.down(".info").observe("click",this._toggleEntrySelection.bindAsEventListener(this))),s){var r=new Element("span",{class:"expand-tool"}).update(this._getExpandCollapseSymbol(!n.hasClassName("root")));r.observe("click",function(e){var t=e.element().up(".entry");this._isExpandToolLocked(t)||this._toggleExpandState(t)}.bindAsEventListener(this));var l=function(e){this._isExpandToolLocked(n)||"yes"!=e.memo.selected||this._expandEntry(n)};n.observe("obrowser:entry:selected",l.bindAsEventListener(this)),n.observe("ynpicker:selectionChanged",l.bindAsEventListener(this)),o.insert({top:r}),this.expand(n,n.hasClassName("root"))}return n},_generateEntryTitle:function(e,t){return new Element("span",{class:"info"}).insert({bottom:new Element("span",{class:"key"}).update("["+e+"]")}).insert({bottom:" "}).insert({bottom:new Element("span",{class:"value"}).update(t)})},_generateEntryCategory:function(e){var t=new Element("span",{class:"hidden term-category"});return this.options.resultCategory&&this._getResultFieldValueAsArray(e,this.options.resultCategory).each((function(e){t.insert(new Element("input",{type:"hidden",value:e}))})),t.hasChildNodes()?t:null},_expandEntry:function(e){e&&(e.down(".descendents")?Event.fire(e,"obrowser:expand:finished"):(e.down(".error")&&e.down(".error").remove(),this.expand(e,!0)),e.removeClassName("collapsed"),e.down(".expand-tool")&&e.down(".expand-tool").update(this._getExpandCollapseSymbol(!1)))},_collapseEntry:function(e){e&&(e.addClassName("collapsed"),Event.fire(e,"obrowser:expand:finished"),e.down(".expand-tool")&&e.down(".expand-tool").update(this._getExpandCollapseSymbol(!0)))},_toggleExpandState:function(e){e&&(!e.down(".descendents")||e.hasClassName("collapsed")?this._expandEntry(e):this._collapseEntry(e))},_obrowserExpandEventHandler:function(e){var t=e.element();if(e.memo){if(e.memo.data?(t.insert({bottom:e.memo.data}),t.stopObserving("obrowser:expand:done",this._obrowserExpandEventHandler)):void 0!==e.memo.count&&t.stopObserving("obrowser:count:done",this._obrowserExpandEventHandler),t.stopObserving("obrowser:expand:failed",this._obrowserExpandEventHandler),"0"==e.memo.count||!t.hasClassName("root")&&e.memo.data&&!t.down(".descendents .entry, .error")){t.addClassName("collapsed");var i=t.down(".expand-tool");i&&(i.update(this._getExpandCollapseSymbol(!0)).addClassName("disabled"),i.stopObserving("click"))}this._unlockExpandTool(t),Event.fire(document,"ms:popup:content-updated",{popup:this.container}),e.memo.data&&Event.fire(t,"obrowser:expand:finished")}},_lockExpandTool:function(e){var t=e.down(".expand-tool");t&&t.addClassName("locked")},_unlockExpandTool:function(e){var t=e.down(".expand-tool");t&&t.removeClassName("locked")},_isExpandToolLocked:function(e){return!!e.down(".expand-tool.locked")},_getExpandCollapseSymbol:function(e){return e?"&#x25ba;":"&#x25bc;"},_toggleEntrySelection:function(e){var t=e.element();if(t.hasClassName("select-tool")){var i=t.up(".entry");t.checked?this._selectEntry(i):this._unselectEntry(i)}else t.up(".entry").down("input").click()},_selectEntry:function(e){if(this.suggest){if(this.options.modal&&"function"==typeof this.container.getPositionInViewport)var t=this.container.getPositionInViewport();var i=e.down(".value").firstChild.nodeValue;this.suggest.acceptEntry({id:e.__termId,value:i,category:e.__termCategory,negative:e.down(".selected.no")},i,"",!0),e.addClassName("accepted"),t&&"function"==typeof this.container.positionDialogInViewport&&this.container.positionDialogInViewport(t.left,t.top),e.fire("obrowser:entry:selected",{selected:e.down(".selected.no")?"no":"yes"})}},_unselectEntry:function(e){this.options.unselectTerm(e.__termId),this.options.unselectTerm(e.__termId,!0),e.removeClassName("accepted")},_browseEntry:function(e){e.stop();var t=e.element().up(".entry");this.load(t.__termId)},_createParentBranch:function(e){return e=this._createBranch("li","parent",e,!1)},_createRoot:function(e){var t=this._createBranch("div","root",e,!0);return this.options.showRoot||(t.addClassName("no-root"),t.down(".entry-data").addClassName("invisible")),t},_createDescendentBranch:function(e){return this._createBranch("li","descendent",e,!0)},_isRootEntry:function(e){return e.hasClassName("entry")&&e.hasClassName("root")},setContent:function(e){this.container.setContent(new Element("div",{class:"ontology-tree"}).update(e))},show:function(e){e&&(this.container.show(),this.__crtRoot!=e?this.load(e):Event.fire(this.container.contentContainer||document,"obrowser:expand:finished"))},hide:function(){this.container.close()}}),e}((PhenoTips=function(e){return(e.widgets=e.widgets||{}).SolrQueryProcessor=Class.create({initialize:function(e,t){this.queryFields=e,this.restriction=t},processQuery:function(e){return this.inflateQuery(e)},generateParameters:function(e){var t={defType:"edismax","spellcheck.collate":!0,spellcheck:!0,lowercaseOperators:!1};return this.setupMandatoryQuery(e,t)||(this.restrictQuery(e,t),this.setupQueryFields(e,t)),t},setupMandatoryQuery:function(e,t){var i=e.strip(),s="",n=!1;for(var o in this.queryFields){var a=this.queryFields[o],r=a.activationRegex;a.mandatory&&r&&i.match(r)&&(s+=o+":"+(a.transform?a.transform(e):e)+" ",n=!0)}return s&&(t.fq=s.strip()),n},restrictQuery:function(e,t){if(this.restriction){var i="";for(var s in this.restriction){for(var n=("-"==s.substring(0,1)?"-":"+")+"(",o=0;o<this.restriction[s].length;++o)n+=s.replace(/^-/,"")+":"+this.restriction[s][o].replace(/:/g,"\\:")+" ";i+=n=n.strip()+") "}i&&(t.fq=i.strip())}},setupQueryFields:function(e,t){var i=e.strip(),s="",n="",o="",a=e.replace(/.*\W/g,"");for(var r in this.queryFields){var l=this.queryFields[r],d=l.activationRegex;d&&!i.match(d)||(l.wordBoost&&(s+=r+"^"+l.wordBoost+" "),l.phraseBoost&&(n+=r+"^"+l.phraseBoost+(l.phraseSlop?"~"+l.phraseSlop:"")+" "),a&&l.stubBoost&&(o+=r+":"+a.replace(/:/g,"\\:")+"*^"+l.stubBoost+" "))}s&&(t.qf=s.strip()),n&&(t.pf=n.strip()),o&&(t.bq=o.strip())},inflateQuery:function(e){var t=e.replace(/.*\W/g,"");if(!t)return e;var i=e;for(var s in this.queryFields)this.queryFields[s].stubTrigger&&(i+=" "+s+":"+t.replace(/:/g,"\\:")+"*");return i.strip()}}),e}((PhenoTips=function(e){var t=e.widgets=e.widgets||{};return t.ModalPopup=Class.create({options:{idPrefix:"modal-popup-",title:"",displayCloseButton:!0,screenColor:"",borderColor:"",titleColor:"",backgroundColor:"",screenOpacity:"0.5",verticalPosition:"center",horizontalPosition:"center",resetPositionOnShow:!0,removeOnClose:!1,onClose:Prototype.emptyFunction},initialize:function(e,i,s){this.shortcuts={show:{method:this.showDialog,keys:[]},close:{method:this.closeDialog,keys:["Esc"]}},this.content=e||"Hello world!",this.shortcuts=Object.extend(Object.clone(this.shortcuts),i||{}),this.options=Object.extend(Object.clone(this.options),s||{}),this.registerShortcuts("show"),void 0===t.ModalPopup.instanceCounter&&(t.ModalPopup.instanceCounter=0),this.id=++t.ModalPopup.instanceCounter},getBoxId:function(){return this.options.idPrefix+this.id},createDialog:function(e){if(this.dialog=new Element("div",{class:"msdialog-modal-container"}),this.options.extraDialogClassName&&this.dialog.addClassName(this.options.extraDialogClassName),this.screen=new Element("div",{class:"msdialog-screen"}).setStyle({opacity:this.options.screenOpacity,backgroundColor:this.options.screenColor}),this.dialog.update(this.screen),this.dialogBox=new Element("div",{class:"msdialog-box",id:this.getBoxId()}),this.options.extraClassName&&this.dialogBox.addClassName(this.options.extraClassName),this.dialogBox._x_contentPlug=new Element("div",{class:"content"}),this.dialogBox.update(this.dialogBox._x_contentPlug),this.dialogBox._x_contentPlug.update(this.content),this.options.title){var t=new Element("div",{class:"msdialog-title"}).update(this.options.title);t.setStyle({color:this.options.titleColor,backgroundColor:this.options.borderColor}),this.dialogBox.insertBefore(t,this.dialogBox.firstChild)}if(this.options.displayCloseButton){var i=new Element("div",{class:"msdialog-close",title:"Cerrar"}).update("&#215;");i.setStyle({color:this.options.titleColor}),i.observe("click",this.closeDialog.bindAsEventListener(this)),this.dialogBox.insertBefore(i,this.dialogBox.firstChild)}this.dialog.appendChild(this.dialogBox),this.dialogBox.setStyle({textAlign:"left",borderColor:this.options.borderColor,backgroundColor:this.options.backgroundColor}),this.positionDialog(),document.body.appendChild(this.dialog),"undefined"!=typeof Draggable&&new Draggable(this.getBoxId(),{handle:$(this.getBoxId()).down(".msdialog-title"),scroll:window,change:this.updateScreenSize.bind(this)}),this.dialog.hide();var s=function(e){this.dialog.visible()&&this.updateScreenSize()}.bindAsEventListener(this);["resize","scroll"].each(function(e){Event.observe(window,e,s)}.bind(this)),Event.observe(document,"ms:popup:content-updated",s)},positionDialog:function(){switch(this.options.verticalPosition){case"top":this.dialogBox.setStyle({top:document.viewport.getScrollOffsets().top+6+"px"});break;case"bottom":this.dialogBox.setStyle({bottom:".5em"});break;default:var e="35%";try{this.dialogBox.parentElement.clientHeight>window.innerHeight&&(e=Math.floor(window.pageYOffset+35*window.innerHeight/100)+"px")}catch(e){}this.dialogBox.setStyle({top:e});break}switch(this.dialogBox.setStyle({left:"",right:""}),this.options.horizontalPosition){case"left":this.dialog.setStyle({textAlign:"left"});break;case"right":this.dialog.setStyle({textAlign:"right"});break;default:this.dialog.setStyle({textAlign:"center"}),this.dialogBox.setStyle({margin:"auto"});break}},positionDialogInViewport:function(e,t){this.dialogBox.setStyle({left:document.viewport.getScrollOffsets().left+e+"px",top:document.viewport.getScrollOffsets().top+t+"px",margin:"0"})},getPositionInViewport:function(){return this.dialogBox.viewportOffset()},updateScreenSize:function(){var e=function(e,t,i){var s=$(document.documentElement)[t](),n=document.viewport.getScrollOffsets()[i]+document.viewport[t]();e&&(e.cumulativeOffset()[i],e[t]());var o="";return s<n&&(o=n+"px"),o};this.screen.style.width=e(this.dialogBox,"getWidth","left"),this.screen.style.height=e(this.dialogBox,"getHeight","top")},setClass:function(e){this.dialogBox.addClassName("msdialog-box-"+e)},removeClass:function(e){this.dialogBox.removeClassName("msdialog-box-"+e)},setContent:function(e){this.content=e,this.dialogBox._x_contentPlug.update(this.content),this.updateScreenSize()},showDialog:function(e){e&&Event.stop(e),this.active||(this.active=!0,this.dialog||this.createDialog(),this.attachKeyListeners(),this.dialog.show(),this.options.resetPositionOnShow&&this.positionDialog(),this.updateScreenSize())},onScroll:function(e){this.dialog.setStyle({top:document.viewport.getScrollOffsets().top+"px"})},closeDialog:function(e){e&&Event.stop(e),this.options.onClose.call(this),this.dialog.hide(),this.options.removeOnClose&&this.dialog.remove(),this.detachKeyListeners(),this.active=!1},attachKeyListeners:function(){for(var e in this.shortcuts)"show"!=e&&this.registerShortcuts(e)},detachKeyListeners:function(){for(var e in this.shortcuts)"show"!=e&&this.unregisterShortcuts(e)},registerShortcuts:function(e){for(var t=this.shortcuts[e].keys,i=this.shortcuts[e].method,s=0;s<t.size();++s)Prototype.Browser.IE||Prototype.Browser.WebKit?shortcut.add(t[s],i.bindAsEventListener(this,e),{type:"keyup"}):shortcut.add(t[s],i.bindAsEventListener(this,e),{type:"keypress"})},unregisterShortcuts:function(e){for(var t=0;t<this.shortcuts[e].keys.size();++t)shortcut.remove(this.shortcuts[e].keys[t])},createButton:function(e,t,i,s){var n=new Element("span",{class:"buttonwrapper"}),o=new Element("input",{type:e,class:"button",value:t,title:i,id:s});return n.update(o),n},show:function(e){this.showDialog(e)},close:function(e){this.closeDialog(e)}}),t.ModalPopup.active=!1,e}((PhenoTips=function(e){return(e.widgets=e.widgets||{}).SuggestPicker=Class.create({options:{showKey:!0,showTooltip:!1,showDeleteTool:!0,enableSort:!0,inputType:"hidden",listInsertionElt:null,listInsertionPosition:"after",predefinedEntries:null,acceptFreeText:!1},initialize:function(e,t,i,s){var n;this.options=Object.extend(Object.clone(this.options),i||{}),this.serializedDataInput=s,this.input=e,this.suggest=t,this.inputName=this.input.name,this.options.acceptFreeText?this.input.addClassName("accept-value"):this.input.name=this.input.name+"__suggested",this.suggest.options.callback=this.acceptSuggestion.bind(this),this.list=new Element("ul",{class:"accepted-suggestions"}),this.options.listInsertionElt&&(n="string"==typeof this.options.listInsertionElt?this.input.up().down(this.options.listInsertionElt):this.options.listInsertionElt),n||(n=this.input);var o={};o[this.options.listInsertionPosition]=this.list,n.insert(o),this.predefinedEntries=this.options.predefinedEntries?$(this.options.predefinedEntries):null,"function"==typeof this.options.onItemAdded&&(this.onItemAdded=this.options.onItemAdded)},acceptAddItem:function(e,t){var i='input[id="'+this.getInputId(e,t).replace(/[^a-zA-Z0-9_-]/g,"\\$&")+'"]',s=this.predefinedEntries?this.predefinedEntries.down(i):this.list?this.list.down(i):$(this.getInputId(e,t));return!s||(s.checked=!0,Event.fire(s,"suggest:change"),this.synchronizeSelection(s),!1)},ensureVisible:function(e,t){if(!(this.silent||!t&&this.options.silent||e.up(".hidden"))){for(var i=e.up(".collapsed:not(.force-collapse)");i;)i.removeClassName("collapsed"),i.down(".expand-tool")&&i.down(".expand-tool").update("▼"),i=i.up(".collapsed:not(.force-collapse)");e.viewportOffset().top>this.input.viewportOffset().top?e.viewportOffset().top>document.viewport.getHeight()&&(e.viewportOffset().top-this.input.viewportOffset().top<document.viewport.getHeight()?this.input.scrollTo():e.scrollTo()):e.cumulativeOffset().top<document.viewport.getScrollOffsets().top&&e.scrollTo()}},acceptSuggestion:function(e){return this.input.value=this.input.defaultValue||"",this.acceptAddItem(e.id||e.value,e.negative)&&this.addItem(e.id||e.value,e.value,e.info,e.category,e.custom),!1},addItem:function(e,t,i,s,n){if(e){var o=this.getInputId(e),a=new Element("li"),r=new Element("label",{class:"accepted-suggestion",for:o}),l={type:this.options.inputType,name:this.inputName,id:o,value:e};if("checkbox"==this.options.inputType&&(l.checked=!0),r.insert({bottom:new Element("input",l)}),this.options.showKey&&!n&&(r.insert({bottom:new Element("span",{class:"key"}).update("["+e.escapeHTML()+"]")}),r.insert({bottom:new Element("span",{class:"sep"}).update(" ")})),r.insert({bottom:new Element("span",{class:"value"}).update(t.escapeHTML())}),a.insert(r),this.suggest.options.tooltip){var d=this.suggest.options.markFreeText&&n?new Element("span",{class:"fa fa-fw fa-exclamation-triangle",title:this.suggest.options.freeTextTooltipHint||""}):new Element("span",{class:"fa fa-info-circle xHelpButton "+this.suggest.options.tooltip,title:e,"data-source":this.input&&this.input.id||""});a.insert(d)}if(s&&""!=s&&a.insert(s),this.options.showDeleteTool){var u=new Element("span",{class:"delete-tool",title:"Eliminar"}).update("&#x2716;");u.observe("click",this.removeItem.bindAsEventListener(this)),a.appendChild(u)}this.options.showTooltip&&i&&(a.appendChild(new Element("div",{class:"tooltip"}).update(i)),a.select(".expand-tool").invoke("observe","click",(function(e){e.stop()}))),this.list.insert(a);var h=this.list?this.list.down('input[id="'+o.replace(/[^a-zA-Z0-9_-]/g,"\\$&")+'"]'):$(o);return this.synchronizeSelection(h),h.observe("change",this.synchronizeSelection.bind(this,h)),this.updateListTools(),Event.fire(document,"xwiki:dom:updated",{elements:[a]}),this.onItemAdded(h),h}},onItemAdded:function(e){},removeItem:function(e){var t=e.findElement&&e.findElement("li")||e;this.synchronizeSelection({value:(t.down("input[type=checkbox]")||t.down("input")).value,checked:!1}),t.remove(),this.notifySelectionChange(t),this.input.value=this.input.defaultValue||"",this.updateListTools()},clearAcceptedList:function(){var e=this;this.list.select("li").each((function(t){e.removeItem(t)}))},updateListTools:function(){if(this.options.enableSort&&this.list.select("li .accepted-suggestion").length>0&&"undefined"!=typeof Sortable&&Sortable.create(this.list),this.serializedDataInput){var e="";this.list.select("li .accepted-suggestion input[type=checkbox]").each((function(t){e+=t.value+"|"})),this.serializedDataInput.value=e}},getInputId:function(e,t){return(t?this.inputName.replace(/(_\d+)_/,"$1_negative_"):this.inputName)+"_"+e},synchronizeSelection:function(e){var t="function"==typeof e.up&&e.up("li");if(t&&this.input.hasClassName("generateYesNo")&&!e.up(".yes-no-picker")){Element.select(t,'input[name="fieldName"][type="hidden"]').each((function(e){var t=e.up("li").down('input[type="checkbox"]'),i=t.name;t.id=t.id.replace(t.name,e.value),t.name=e.value,t.up("label").addClassName(e.className),t.up("label").htmlFor=t.id,e.value=i,e.up(".term-category")&&e.up(".term-category").insert({before:e})}));var i=this.input.name.replace(/__suggested$/,""),s=this.input.name.replace(/(_\d+)_/,"$1_negative_").replace(/__suggested$/,""),n=e.value,o=t.down(".value").firstChild.nodeValue,a=YesNoPicker.generatePickerElement([{type:"na",selected:!isValueSelected(i,n)&&!isValueSelected(s,n)},{type:"yes",name:i,selected:isValueSelected(i,n)},{type:"no",name:s,selected:isValueSelected(s,n)}],n,o,!0,e.next());e.insert({before:a}),e.hide(),e.name="",e.id="",e.value="",enableHighlightChecked(a.down(".yes input")),enableHighlightChecked(a.down(".no input"))}t&&this.notifySelectionChange(t)},notifySelectionChange:function(e){e.__categoryArray||(e.__categoryArray=[],Element.select(e,".term-category input[type=hidden]").each((function(t){e.__categoryArray.push(t.value)}))),Event.fire(this.input,"xwiki:form:field-value-changed"),Event.fire(document,"custom:selection:changed",{categories:e.__categoryArray,trigger:this.input,fieldName:this.inputName,customElement:e})}}),e}((PhenoTips=function(e){var t=e.widgets=e.widgets||{};return void 0===XWiki.widgets.XList?"undefined"!=typeof console&&console.warn:(t.XList=XWiki.widgets.XList,t.XListItem=XWiki.widgets.XListItem,t.Suggest=Class.create({options:{minchars:1,method:"get",varname:"input",matchVarname:"id",className:"ajaxsuggest",timeout:3e4,delay:500,offsety:0,shownoresults:!0,noresults:"No results!",maxheight:250,cache:!1,seps:"",icon:null,resultsParameter:"results",resultId:"id",resultValue:"value",resultInfo:"info",resultCategory:"category",resultAltName:"",resultIcon:"icon",resultHint:"hint",tooltip:!1,markFreeText:!1,highlight:!0,fadeOnClear:!1,enableHideButton:!0,insertBeforeSuggestions:null,displayId:!1,forceFirstId:!1,displayValue:!1,displayValueText:"Value :",align:"left",unifiedLoader:!1,loaderNode:null,filterFunc:null,json:!0},sInput:"",nInputChars:0,aSuggestions:[],iHighlighted:null,isActive:!1,suggestionSelected:!1,lastSubmitted:"",initialize:function(e,t){if(!e)return!1;this.setInputField(e),this.fixedSuggestions=[],this.options=Object.extend(Object.clone(this.options),t||{}),"object"==typeof this.options.sources&&this.options.sources.length>1?this.sources=this.options.sources:this.sources=this.options,this.sources=[this.sources].flatten().compact(),$(this.options.parentContainer)||(this.options.parentContainer=$(document.body)),this.options.seps?this.seps=this.options.seps:this.seps="",this.latestRequest=0,this.addInputObservers()},setInputField:function(e){this.fld&&this.fld.stopObserving(),this.fld=$(e),this.fld._suggestWidget=this,this.fld.observe("keyup",this.onKeyUp.bindAsEventListener(this)),Prototype.Browser.IE||Prototype.Browser.WebKit?this.fld.observe("keydown",this.onKeyPress.bindAsEventListener(this)):this.fld.observe("keypress",this.onKeyPress.bindAsEventListener(this)),this.fld.observe("paste",this.onPaste.bindAsEventListener(this)),this.fld.setAttribute("autocomplete","off"),this.fld.observe("blur",function(e){this.latestRequest++,this.fld.removeClassName("loading")}.bind(this))},addInputObservers:function(){$(document).observe("ms:suggest:containerCreated",this.onSuggestCreated.bindAsEventListener(this)),$(document).observe("ms:suggest:selected",this.onDataSubmitted.bindAsEventListener(this)),this.fld.observe("blur",this.onInputBlurred.bindAsEventListener(this))},onKeyUp:function(e){switch(e.keyCode){case Event.KEY_RETURN:case Event.KEY_TAB:case Event.KEY_ESC:case Event.KEY_UP:case Event.KEY_DOWN:break;default:if(this.seps){for(var t=-1,i=0;i<this.seps.length;i++)this.fld.value.lastIndexOf(this.seps.charAt(i))>t&&(t=this.fld.value.lastIndexOf(this.seps.charAt(i)));-1==t?this.getSuggestions(this.fld.value):this.getSuggestions(this.fld.value.substring(t+1))}else this.getSuggestions(this.fld.value)}},onPaste:function(e){setTimeout(function(){this.onKeyUp({keyCode:null})}.bind(this),0)},onKeyPress:function(e){if($(this.isActive)){var t=e.keyCode;switch(t){case Event.KEY_RETURN:this.setHighlightedValue(),Event.stop(e);break;case Event.KEY_TAB:this.clearSuggestions();break;case Event.KEY_ESC:this.clearSuggestions(),Event.stop(e);break;case Event.KEY_UP:this.changeHighlight(t),Event.stop(e);break;case Event.KEY_DOWN:this.changeHighlight(t),Event.stop(e);break;default:break}}else e.keyCode==Event.KEY_RETURN&&Event.stop(e)},onSuggestCreated:function(e){this.suggestionSelected=!1;var t=this;e.memo.container&&$(e.memo.container).observe("mousedown",(function(e){t.suggestionSelected=!0}))},onDataSubmitted:function(e){this.suggestionSelected=!0,this.lastSubmitted=e.memo.value||this.fld.value.strip()},onInputBlurred:function(e){if(this.suggestionSelected||this.fld.value.length<this.options.minchars)this.suggestionSelected=!1;else{var t=this.fld.value.strip();if(!this.submitDropdownMatch(t)){if(t==this.lastSubmitted&&t.length>1)return;clearTimeout(this.ajID),this.submitAjaxSearchMatch(t,++this.latestRequest)}}},submitDropdownMatch:function(e){if(void 0===this.aSuggestions||this.aSuggestions.length<=0)return!1;for(var t=e.toUpperCase(),i=0;i<this.aSuggestions.length;i++){var s=this.aSuggestions[i];if(s.value.strip().toUpperCase()===t||s.id.strip().toUpperCase()===t)return this.acceptEntry(s,s.value,s.value),!0}return!1},submitAjaxSearchMatch:function(e,t){if(this.lastSubmitted=this.fld.value.strip(),!(t<this.latestRequest||this.fld.value.strip().length<this.options.minchars))for(var i=0;i<this.sources.length;i++){var s=this.sources[i];if(s.matchScript){var n=s.matchScript+s.matchVarname+"="+encodeURIComponent(e),o=s.method||"get",a={};s.json?a.Accept="application/json":a.Accept="application/xml",new Ajax.Request(n,{method:o,requestHeaders:a,onCreate:function(){this.fld.addClassName("loading")}.bind(this),onSuccess:this.setSearchData.bindAsEventListener(this,s,e,t),onComplete:function(){t<this.latestRequest||this.fld.removeClassName("loading")}.bind(this)})}}},setSearchData:function(e,t,i,s){if(s<this.latestRequest)return!1;var n,o;if(t&&t.json){if(!(a=e.responseJSON))return!1;n=function(e,t){return e&&(e[t+"_translated"]||e[t])||""},o=function(e,t){return new Array(e&&(e[t+"_translated"]||e[t])||"").flatten()}}else{var a;if(!(a=e.responseXML))return!1;n=function(e,t){var i=e&&Element.down(e,t);return i&&i.firstChild&&i.firstChild.nodeValue||""},o=function(e,t){var i=[];return e&&Element.select(e,t).each((function(e){var t=e.firstChild&&e.firstChild.nodeValue;t&&i.push(t)})),i}}var r={suggest:this,id:this._processId(n(a,t.resultId||this.options.resultId),t.forceFirstId||this.options.forceFirstId),value:n(a,t.resultValue||this.options.resultValue),info:this.generateResultInfo(a,o),icon:n(a,t.resultIcon||this.options.resultIcon),category:this.generateResultCategory(a,o)};this.acceptTypedInput(r,r.value)},acceptTypedInput:function(e,t,i){Event.fire(this.fld,"ms:suggest:selected",e).stopped||(i||(this.fld.value=t||this.fld.defaultValue||""),"function"==typeof this.options.callback&&this.options.callback(e))},getSuggestions:function(e){if((e=e.strip().toLowerCase())==this.sInput&&e.length>1)return!1;if(0==e.length)return this.sInput="",this.clearSuggestions(),!1;if(e.length<this.options.minchars)return this.sInput="",!1;if(e.length>this.nInputChars&&this.aSuggestions.length&&this.options.cache){for(var t=[],i=0;i<this.aSuggestions.length;i++)this.aSuggestions[i].value.substr(0,e.length).toLowerCase()==e&&t.push(this.aSuggestions[i]);return this.sInput=e,this.nInputChars=e.length,this.aSuggestions=t,this.createList(this.aSuggestions),!1}this.sInput=e,this.nInputChars=e.length,this.prepareContainer(),this.latestRequest++;var s=this,n=this.latestRequest;return this.sources&&this.sources.length>0?(clearTimeout(this.ajID),this.ajID=setTimeout((function(){s.doAjaxRequests(n)}),this.options.delay)):this.fixedSuggestions&&this.fixedSuggestions.length>0&&(this.aSuggestions=[],this.fixedSuggestions.each((function(t){t.value.substr(0,e.length).toLowerCase()==e&&s.aSuggestions.push(t)})),s.createList(s.aSuggestions)),!1},doAjaxRequests:function(e){if(!(e<this.latestRequest||this.fld.value.length<this.options.minchars))for(var t=0;t<this.sources.length;t++){var i=this.sources[t],s=this.fld.value.strip(),n=i.script+i.varname+"="+encodeURIComponent(s),o=i.method||"get",a={};i.json?a.Accept="application/json":a.Accept="application/xml",new Ajax.Request(n,{method:o,requestHeaders:a,onCreate:function(){this.fld.addClassName("loading")}.bind(this),onSuccess:this.setSuggestions.bindAsEventListener(this,i,e),onFailure:function(e){alert("Failed to retrieve suggestions : "+e.statusText)},onComplete:function(){var t=this;e<this.latestRequest||(t.fixedSuggestions&&t.fixedSuggestions.length>0&&(t.aSuggestions||(t.aSuggestions=[]),t.fixedSuggestions.each((function(e){e.value.substr(0,t.sInput.length).toLowerCase()!=t.sInput||t.aSuggestions.some((function(t){return t.value==e.value}))||t.aSuggestions.push(e)})),t.createList(t.aSuggestions)),this.fld.removeClassName("loading"))}.bind(this)})}},setSuggestions:function(e,t,i){i<this.latestRequest||(this.aSuggestions=this.getSuggestionList(e,t),this.createList(this.aSuggestions,t))},getSuggestionList:function(e,t){var i=[];if(t&&t.json){var s=e.responseJSON;if(!s)return!1;var n=s[t.resultsParameter||this.options.resultsParameter],o=function(e,t){return e&&(e[t+"_translated"]||e[t])||""},a=function(e,t){return new Array(e&&(e[t+"_translated"]||e[t])||"").flatten()}}else{var r=e.responseXML;if(!r)return!1;n=r.getElementsByTagName(t&&t.resultsParameter||this.options.resultsParameter),o=function(e,t){var i=e&&Element.down(e,t);return i&&i.firstChild&&i.firstChild.nodeValue||""},a=function(e,t){var i=new Array;return e&&Element.select(e,t).each((function(e){var t=e.firstChild&&e.firstChild.nodeValue;t&&i.push(t)})),i}}for(var l=0;l<n.length;l++){var d=this.generateResultInfo(n[l],a),u=this.generateResultCategory(n[l],a);if(this.options.resultAltName)for(var h="",c=o(n[l],t.resultValue||this.options.resultValue),p=a(n[l],t.resultAltName||this.options.resultAltName),m=this.computeSimilarity(c,this.sInput),f=0;f<p.length;++f){var g=this.computeSimilarity(p[f],this.sInput);g>m&&(h=p[f],m=g)}i.push({id:this._processId(o(n[l],t.resultId||this.options.resultId),t.forceFirstId||this.options.forceFirstId),value:o(n[l],t.resultValue||this.options.resultValue),icon:o(n[l],t.resultIcon||this.options.resultIcon),altName:h,info:d,category:u})}return i},_processId:function(e,t){return e.constructor===Array&&t?e.length>0?e[0]:"":e},generateResultInfo:function(e,t){var i=new Element("dl"),s=this;for(var n in this.options.resultInfo){var o=this.options.resultInfo[n],a=n.strip().toLowerCase().replace(/[^a-z0-9 ]/gi,"").replace(/\s+/gi,"-"),r="";o.collapsed&&(r="collapsed");var l=o.processor;if(o.extern){var d=new Element("a").update(n);d._processingFunction=l,i.insert({bottom:new Element("dt",{class:r+" "+a}).insert({bottom:d})}),d._processingFunction.call(this,d)}else{var u=o.selector;if(u){var h=null;t(e,u).each((function(e){var t=e||"";if("function"==typeof l&&(t=l(t)),""!=t){if(!h){var a=new Element("a",{class:"expand-tool"}).update(s._getExpandCollapseTriggerSymbol(o.collapsed));i.insert({bottom:new Element("dt",{class:r}).insert({top:a}).insert({bottom:n})}),h=new Element("dd",{class:"expandable"}),i.insert({bottom:h}),a.observe("click",function(e){e.stop(),a.up().toggleClassName("collapsed"),a.update(s._getExpandCollapseTriggerSymbol(a.up().hasClassName("collapsed")))}.bindAsEventListener(this))}h.insert({bottom:new Element("div").update(t)})}}))}}}return i.hasChildNodes()||(i=""),i},generateResultCategory:function(e,t){if(this.options.resultCategory){var i=new Element("span",{class:"hidden term-category"});t(e,this.options.resultCategory).each((function(e){i.insert(new Element("input",{type:"hidden",value:e}))}))}return this.options.resultCategory&&i.hasChildNodes()||(i=""),i},_getExpandCollapseTriggerSymbol:function(e){return e?"&#x25B8;":"&#x25BE;"},computeSimilarity:function(e,t){var s,n=0,o=e,a=o.length,r=t,l=r.length,d=new Array;for(i=0;i<l;i++)d[i]=new Array,s=o.charAt(i)==r.charAt(0)?1:-1,0==i?d[0][0]=Math.max(0,-2,s):d[i][0]=Math.max(0,d[i-1][0]-2,s),d[i][0]>n&&(n=d[i][0]);for(j=0;j<a;j++)s=o.charAt(0)==r.charAt(j)?1:-1,0==j?d[0][0]=Math.max(0,-2,s):d[0][j]=Math.max(0,d[0][j-1]-2,s),d[0][j]>n&&(n=d[0][j]);for(i=1;i<l;i++)for(j=1;j<a;j++)s=o.charAt(i)==r.charAt(j)?1:-1,d[i][j]=Math.max(0,d[i-1][j]-2,d[i][j-1]-2,d[i-1][j-1]+s),d[i][j]>n&&(n=d[i][j]);return n},prepareContainer:function(){var e=$(this.options.parentContainer).down(".suggestItems");if(e&&e.__targetField!=this.fld&&(e.__targetField?e.__targetField._suggest.clearSuggestions():e.remove(),e=!1),!e){var t=new Element("div",{class:"suggestItems "+this.options.className}),i="body"==$(this.options.parentContainer).tagName.toLowerCase()?this.fld.cumulativeOffset():this.fld.positionedOffset(),s=this.options.width?this.options.width:this.fld.offsetWidth-2;"left"==this.options.align?t.style.left=i.left+"px":"center"==this.options.align?t.style.left=i.left+(this.fld.getWidth()-s-2)/2+"px":t.style.left=i.left-s+this.fld.offsetWidth-2+"px",t.style.top=i.top+this.fld.offsetHeight+this.options.offsety+"px",t.style.width=s+"px";var n=this;t.onmouseover=function(){n.killTimeout()},t.onmouseout=function(){n.resetTimeout()},this.resultContainer=new Element("div",{class:"resultContainer"}),t.appendChild(this.resultContainer),$(this.options.parentContainer).insert(t),this.container=t,this.options.insertBeforeSuggestions&&this.resultContainer.insert(this.options.insertBeforeSuggestions),document.fire("ms:suggest:containerCreated",{container:this.container,suggest:this})}if(this.sources.length>1)for(var o=0;o<this.sources.length;o++){var a=this.sources[o];if(a.id=o,this.resultContainer.down(".results"+a.id))this.resultContainer.down(".results"+a.id).down("ul")&&this.resultContainer.down(".results"+a.id).down("ul").remove(),this.options.unifiedLoader?((this.options.loaderNode||this.fld).addClassName("loading"),this.resultContainer.down(".results"+a.id).addClassName("hidden loading")):this.resultContainer.down(".results"+a.id).down(".sourceContent").addClassName("loading");else{var r=new Element("div",{class:"results results"+a.id}),l=new Element("div",{class:"sourceName"});if(this.options.unifiedLoader&&r.addClassName("hidden loading"),void 0!==a.icon){var d=new Image;d.onload=function(){this.sourceHeader.setStyle({backgroundImage:"url("+this.iconImage.src+")"}),this.sourceHeader.setStyle({textIndent:this.iconImage.width+6+"px"})}.bind({sourceHeader:l,iconImage:d}),d.src=a.icon}l.insert(a.name),r.insert(l);var u="sourceContent "+(this.options.unifiedLoader?"":"loading");r.insert(new Element("div",{class:u})),void 0!==a.before&&this.resultContainer.insert(a.before),this.resultContainer.insert(r),void 0!==a.after&&this.resultContainer.insert(a.after)}}else this.resultContainer.down("ul")&&this.resultContainer.down("ul").remove();if(this.container.fire("ms:suggest:containerPrepared",{container:this.container,suggest:this}),this.container.__targetField=this.fld,this.options.enableHideButton&&!this.container.down(".hide-button")){var h=new Element("span",{class:"hide-button"}).update("ocultar sugerencias");h.observe("click",this.clearSuggestions.bindAsEventListener(this)),this.container.insert({bottom:new Element("div",{class:"hide-button-wrapper"}).update(h)})}return this.container},createList:function(e,t){this.isActive=!0;var i=this;if(this.killTimeout(),this.clearHighlight(),this.sources.length>1){var s=this.resultContainer.down(".results"+t.id);(e.length>0||this.options.shownoresults)&&(s.down(".sourceContent").removeClassName("loading"),this.resultContainer.down(".results"+t.id).removeClassName("hidden loading")),this.options.unifiedLoader&&!this.resultContainer.down("loading")&&(this.options.loaderNode||this.fld).removeClassName("loading")}else s=this.resultContainer;if(0==e.length&&!this.options.shownoresults)return!1;s.down("ul")&&s.down("ul").remove();var n=this.createListElement(e,i);s.appendChild(n),Event.fire(document,"xwiki:dom:updated",{elements:[n]}),this.suggest=s,i=this,this.options.timeout>0&&(this.toID=setTimeout((function(){i.clearSuggestions()}),this.options.timeout)),this.highlightFirst()},createListElement:function(t,i){for(var s=new e.widgets.XList([],{icon:this.options.icon,classes:"suggestList",eventListeners:{click:function(){return i.setHighlightedValue(),!1},mouseover:function(){i.setHighlight(this.getElement())}}}),n=0,o=t.length;n<o;n++)this.options.filterFunc&&!this.options.filterFunc(t[n])||s.addItem(this.generateListItem(t[n]));if(0==t.length&&s.addItem(new e.widgets.XListItem(this.options.noresults,{classes:"noSuggestion",noHighlight:!0})),this.fld.hasClassName("accept-value")){var a=this.fld.value.replace(/[^a-z0-9_]+/gi,"_"),r=this.fld.next('input[name="_category"]'),l=r&&r.value.split(",")||[],d=new Element("div",{class:"hidden term-category"}),u=this.fld.name+"__"+a+"__category";l.each((function(e){e&&d.insert(new Element("input",{type:"hidden",name:u,value:e}))})),s.addItem(this.generateListItem({id:this.fld.value,value:this.fld.value,category:d,custom:!0,info:new Element("div",{class:"hint"}).update("")},"custom-value",!0))}return s.getElement()},generateListItem:function(t,i,s){var n=new Element("div",{class:"tooltip-"+this.options.tooltip});if(t.icon&&n.insert(new Element("img",{src:t.icon,class:"icon"})),this.options.displayId&&n.insert(new Element("span",{class:"suggestId"}).update(t.id.escapeHTML())),n.insert(new Element("span",{class:"suggestValue"}).update(t.value.escapeHTML())),this.options.tooltip&&!s){var o=new Element("span",{class:"fa fa-info-circle xHelpButton "+this.options.tooltip,title:t.id,"data-source":this.fld.id});o.observe("click",(function(e){e.stop()})),n.insert(" ").insert(o)}var a=new Element("div",{class:"suggestInfo"}).update(t.info);n.insert(a),t.altName&&a.insert({top:new Element("span",{class:"matching-alternative-name"}).update(t.altName.escapeHTML())});var r=new Element("div").insert(new Element("span",{class:"suggestId"}).update(t.id.escapeHTML())).insert(new Element("span",{class:"suggestValue"}).update(t.value.escapeHTML())).insert(new Element("div",{class:"suggestCategory"}).update(t.category));t.custom&&r.insert(new Element("div",{class:"isCustom"}).update(t.custom)),r.store("itemData",t);var l=new e.widgets.XListItem(n,{containerClasses:"suggestItem "+(i||""),value:r,noHighlight:!0});return Event.fire(this.fld,"ms:suggest:suggestionCreated",{element:l.getElement(),suggest:this}),l},emphasizeMatches:function(e,t){for(var i=t,s=e.split(" ").uniq().compact(),n=0,o={},a=0,r=s.length;a<r;a++)for(var l=i.toLowerCase().indexOf(s[a].toLowerCase());l>=0;){var d=i.substring(l,l+s[a].length),u="";s[a].length.times((function(){u+=" "})),o[l]=d,l=(i=i.substring(0,l)+u+i.substring(l+s[a].length)).toLowerCase().indexOf(s[a].toLowerCase())}return Object.keys(o).sortBy((function(e){return parseInt(e)})).each((function(e){var t=i.substring(0,parseInt(e)+n),s=i.substring(parseInt(e)+o[e].length+n);i=t+"<em>"+o[e]+"</em>"+s,n+=9})),i},changeHighlight:function(e){var t,i=this.resultContainer;if(!i)return!1;if(this.iHighlighted){if(e==Event.KEY_DOWN){if(!(t=this.iHighlighted.next())&&this.iHighlighted.up("div.results"))for(var s=this.iHighlighted.up("div.results").next();s&&!t;)t=s.down("li"),s=s.next();t||(t=i.down("li"))}else if(e==Event.KEY_UP){if(!(t=this.iHighlighted.previous())&&this.iHighlighted.up("div.results"))for(s=this.iHighlighted.up("div.results").previous();s&&!t;)t=s.down("li:last-child"),s=s.previous();t||(t=i.select("ul")[i.select("ul").length-1].down("li:last-child"))}}else e==Event.KEY_DOWN?t=i.down("div.results")?i.down("div.results").down("li"):i.down("li"):e==Event.KEY_UP&&i.select("li")>0&&(t=i.select("li")[i.select("li").length-1]);t&&this.setHighlight(t)},setHighlight:function(e){this.iHighlighted&&this.clearHighlight(),e.addClassName("xhighlight"),this.iHighlighted=e,this.killTimeout()},clearHighlight:function(){this.iHighlighted&&(this.iHighlighted.removeClassName("xhighlight"),delete this.iHighlighted)},highlightFirst:function(){if(this.suggest&&this.suggest.down("ul")){var e=this.suggest.down("ul").down("li");e&&this.setHighlight(e)}},hasActiveSelection:function(){return this.iHighlighted},setHighlightedValue:function(){if(this.iHighlighted&&!this.iHighlighted.hasClassName("noSuggestion")){var e,t;if(""==this.sInput&&""==this.fld.value)e=t=this.iHighlighted.down(".suggestValue").innerHTML;else if(this.seps){for(var i=-1,s=0;s<this.seps.length;s++)this.fld.value.lastIndexOf(this.seps.charAt(s))>i&&(i=this.fld.value.lastIndexOf(this.seps.charAt(s)));e=-1==i?t=this.iHighlighted.down(".suggestValue").innerHTML:(t=this.fld.value.substring(0,i+1)+this.iHighlighted.down(".suggestValue").innerHTML).substring(i+1)}else e=t=this.iHighlighted.down(".suggestValue").innerHTML;var n=this.iHighlighted.down(".value div").retrieve("itemData"),o={suggest:this,id:n.id||this.iHighlighted.down(".suggestId").innerHTML,value:n.value||this.iHighlighted.down(".suggestValue").innerHTML,info:n.info||this.iHighlighted.down(".suggestInfo").innerHTML,icon:n.icon||(this.iHighlighted.down("img.icon")?this.iHighlighted.down("img.icon").src:""),category:this.iHighlighted.down(".suggestCategory").innerHTML,custom:n.custom||!1};this.acceptEntry(o,e,t)}},acceptEntry:function(e,t,i,s){if(!Event.fire(this.fld,"ms:suggest:selected",e).stopped){if(s||(this.sInput=t,this.fld.value=i||this.fld.defaultValue||"",this.fld.focus(),this.clearSuggestions()),"function"==typeof this.options.callback&&this.options.callback(e),this.fld.id.indexOf("_suggest")>0){var n=this.fld.id.substring(0,this.fld.id.indexOf("_suggest")),o=$(n);o&&(o.value=info)}this.fixedSuggestions.some((function(t){return t.value.toLowerCase()==e.value.toLowerCase()}))||this.fixedSuggestions.push(e)}},killTimeout:function(){clearTimeout(this.toID)},resetTimeout:function(){clearTimeout(this.toID);var e=this;this.toID=setTimeout((function(){e.clearSuggestions()}),1e6)},clearSuggestions:function(){this.killTimeout(),this.isActive=!1;var e=$(this.container),t=this;e&&e.parentNode&&(this.options.fadeOnClear?new Effect.Fade(e,{duration:"0.25",afterFinish:function(){$(t.container)&&$(t.container).remove()}}):$(this.container).remove(),document.fire("ms:suggest:clearSuggestions",{suggest:this}))}})),e}(PhenoTips||{}))||{}))||{}))||{}))||{}))||{});StickyBox=Class.create({options:{offsetTop:6,offsetBottom:0,resize:!1,isSticky:function(e){return!0}},initialize:function(e,t,i){this.stickyElement=e,this.stickyAreaElement=t,this.stickyElement&&this.stickyAreaElement&&(this.options=Object.extend(Object.clone(this.options),i||{}),this.options.shadowSize&&void 0===i.offsetTop&&(this.options.offsetTop=this.options.shadowSize),this.resetPosition=this.resetPosition.bindAsEventListener(this),Event.observe(window,"scroll",this.resetPosition),Event.observe(window,"resize",this.resetPosition),"function"==typeof this.options.makeDefault&&(this.makeDefault=this.options.makeDefault.bind(this)),this.resetPosition())},resetPosition:function(){if(this.options.isSticky(this.stickyElement)&&!(this.stickyElement.getHeight()>=this.stickyAreaElement.getHeight())){this.stickyElement.style.height="",this.stickyElement.style.overflow="",this.stickyElement.fire("size:changed"),this.boxHeight=this.stickyElement.getHeight();var e=document.viewport.getHeight()-this.options.offsetTop-this.options.offsetBottom;if(this.options.resize){var t={diff:e-this.boxHeight,original:this.boxHeight};this.boxHeight=e,this.stickyElement.style.height=this.boxHeight+"px",this.stickyElement.style.overflow="auto",this.stickyElement.fire("size:changed",t)}this.boxWidth=this.stickyElement.getWidth(),this.boxMinTop=this.stickyAreaElement.cumulativeOffset().top+this.options.offsetTop,this.boxMaxTop=this.stickyAreaElement.cumulativeOffset().top+this.stickyAreaElement.getHeight()-this.boxHeight,this.boxLeft=this.stickyElement.cumulativeOffset().left,this.boxRelativeLeft=this.boxLeft-this.stickyElement.getOffsetParent().viewportOffset().left;var i=this.stickyAreaElement.viewportOffset().top;this.direction=0,this.stickyAreaElement._prevPosition&&(this.stickyAreaElement._prevPosition>i?this.direction=1:this.stickyAreaElement._prevPosition<i&&(this.direction=-1)),(this.options.isSticky(this.stickyElement)||1==this.direction)&&document.viewport.getScrollOffsets().top>=this.boxMinTop&&document.viewport.getScrollOffsets().top<this.boxMaxTop?this.makeFixed():(this.options.isSticky(this.stickyElement)||-1==this.direction)&&document.viewport.getScrollOffsets().top>=this.boxMaxTop?this.makeAbsolute():this.makeDefault(),this.stickyAreaElement._prevPosition=i}},makeFixed:function(){"fixed"!=this.stickyElement.style.position&&(this.stickyElement.addClassName("sticky"),this.stickyElement.style.left=this.boxLeft+"px",this.stickyElement.style.width=this.boxWidth+"px",this.stickyElement.style.top=this.options.offsetTop+"px",this.stickyElement.style.right="",this.stickyElement.style.position="fixed")},makeAbsolute:function(e){if("absolute"!=this.stickyElement.style.position){this.stickyElement.addClassName("sticky"),e=e||this.stickyAreaElement.getHeight()-this.stickyElement.getHeight(),this.stickyElement.style.top=e+"px",this.stickyElement.style.right="";var t=this.stickyElement.getStyle("position");this.stickyElement.style.position="absolute","fixed"!=t||Prototype.Browser.WebKit?this.stickyElement.style.left=this.boxRelativeLeft+"px":this.stickyElement.style.left=this.boxRelativeLeft-this.stickyElement.getOffsetParent().viewportOffset().left+2+"px"}},makeDefault:function(){""!=this.stickyElement.style.position&&(this.stickyElement.removeClassName("sticky"),this.stickyElement.style.position="",this.stickyElement.style.top="",this.stickyElement.style.left="",this.stickyElement.style.right="",this.stickyElement.style.width="")},isFixed:function(){return"fixed"==this.stickyElement.style.position},isAbsolute:function(){return"absolute"==this.stickyElement.style.position},isDefault:function(){return""==this.stickyElement.style.position}}),PhenoTips=function(e){return(e.widgets=e.widgets||{}).FreeMultiselect=Class.create({counter:1,options:{returnKeyNavigation:!1,extraClasses:""},initialize:function(t,i){this.options=Object.extend(Object.clone(this.options),i||{});var s=this,n=t.previous('input[name="xwiki-free-multiselect-suggest-extraclasses"][type="hidden"]');n&&(this.options.extraClasses=n.value);var o=t.previous('input[name="xwiki-free-multiselect-suggest-script"][type="hidden"]');if(o&&o.value&&void 0!==e.widgets.Suggest&&(this.suggestOptions={script:o.value,shownoresults:!1,varname:"input",timeout:0,resultsParameter:"rows",resultValue:"name",resultInfo:{}}),this.enhanceLine=this.enhanceLine.bind(this),t.select("li input.xwiki-free-multiselect-value").each(this.enhanceLine),t.down("input.xwiki-free-multiselect-value")){var a=new Element("a",{title:"add",href:"#"+t.id}).update("+…");t.insert(a.wrap("li")),a.observe("click",function(e){e.stop();var t=a.up("li").previous(),i=t&&t.down("input.xwiki-free-multiselect-value");i&&s.generateInput(i)}.bindAsEventListener(this))}},enhanceLine:function(t){t.id=this.generateId(t),t.up("li").addClassName("xwiki-free-multiselect-line"),this.attachDeleteTool(t),this.suggestOptions&&new e.widgets.Suggest(t,this.suggestOptions),this.enableAddInput(t)},attachDeleteTool:function(e){var t=e.up(".xwiki-free-multiselect-line"),i=new Element("a",{title:"delete",href:"#"+e.id}).update("✖");t.insert(" ").insert(i),i.observe("click",(function(e){e.stop();var t=e.findElement(".xwiki-free-multiselect-line");if(t.previous(".xwiki-free-multiselect-line")||t.next(".xwiki-free-multiselect-line"))t.remove();else{var i=t.down("input");i.value="",i.focus()}}))},enableAddInput:function(e){var t=e.up(".xwiki-free-multiselect-line"),i=this;t&&e.observe("keypress",(function(s){if(s.keyCode==Event.KEY_RETURN){s.stop();var n=t.next(".xwiki-free-multiselect-line");i.options.returnKeyNavigation&&n&&n.down("input")?n.down("input").focus():(e.next().removeClassName("inactive"),i.generateInput(e))}else if(s.keyCode==Event.KEY_BACKSPACE&&""==e.value){s.stop();var o=t.previous(".xwiki-free-multiselect-line");o&&o.down("input")&&(o.down("input").focus(),e.up(".xwiki-free-multiselect-line").remove())}}))},generateInput:function(e){var t=new Element("input",{name:e.name,id:this.generateId(e),type:e.type,size:e.size,class:"xwiki-free-multiselect-value "+this.options.extraClasses}),i=new Element("li");i.insert(t),e.up(".xwiki-free-multiselect-line").insert({after:i}),this.enhanceLine(t),t.focus()},generateId:function(e){return e.name+"_"+this.nextIndex()},nextIndex:function(){return++this.counter},lastIndex:function(){return this.counter}}),e}(PhenoTips||{});var init=function(e){(e&&e.memo.elements||[$("body")]).each((function(e){e.select(".xwiki-free-multiselect").each((function(e){new PhenoTips.widgets.FreeMultiselect(e)}))}))};XWiki.domIsLoaded&&init()||document.observe("xwiki:dom:loaded",init),document.observe("xwiki:dom:updated",init);var XWiki=function(e){(e.widgets=e.widgets||{}).VisibilityController=Class.create({initialize:function(e){this.element=e,this.reverse=this.element.hasClassName("exclude"),this.controller=this.element.select(".controller input[type=checkbox]");var t="change";0!=this.controller.length&&(1==this.controller.length?this.controller=this.controller[0]:(this.controller=this.element.down(".controller .yes input[type=checkbox]"),t="picker:change"),this.controller&&(this.controlled=this.element.select(".controlled"),this.element.hasClassName("complete-hide")?(this.hiddenStyle={display:"none"},this.visibleStyle={display:""}):(this.hiddenStyle={visibility:"hidden"},this.visibleStyle={visibility:"visible"}),this.controlVisibility(),this.element.hasClassName("confirm")?this.controller.observe(t,this.confirm.bindAsEventListener(this)):this.controller.observe(t,this.controlVisibility.bindAsEventListener(this))))},controlVisibility:function(){this.controller.checked^this.reverse?(this.controlled.invoke("setStyle",this.hiddenStyle),this.element.select(".controlled input").invoke("disable")):(this.controlled.invoke("setStyle",this.visibleStyle),this.element.select(".controlled input").invoke("enable"))},confirm:function(t){this.element.hasClassName("confirm-yes")&&!this.controller.checked||this.element.hasClassName("confirm-no")&&this.controller.checked?this.controlVisibility():new e.widgets.ConfirmationBox({onYes:function(){this.controlVisibility()}.bind(this),onNo:function(){this.controller.checked=!this.controller.checked}.bind(this)},{confirmationText:"This will remove all table data entered below. Are you sure you want to proceed?",showCancelButton:!1})}});var t=function(t){return(t&&t.memo.elements||[$("body")]).each((function(t){t.select(".controlled-group").each((function(t){t.__visibilityController||(t.__visibilityController=new e.widgets.VisibilityController(t))}))})),!0};return e.domIsLoaded&&t()||document.observe("xwiki:dom:loaded",t),document.observe("xwiki:dom:updated",t),e}(XWiki||{});PhenoTips=function(e){var t=e.widgets=e.widgets||{};t.FuzzyDatePickerDropdown=Class.create({initialize:function(e){this.span=new Element("span"),this.options=e,this.callback=null},populate:function(e){var t=this.dropdown?this.dropdown.selectedIndex||this._tmpSelectedIndex:0,i='<select name="'+this.options.name+'" class="'+(this.options.cssClass||this.options.name||"")+'" placeholder="'+(this.options.hint||this.options.name||"")+'" title="'+(this.options.hint||this.options.name||"")+'">';i+='<option value="" class="empty"> </option>',e.each((function(e){i+='<option value="'+e.value+'"',e.cssClass&&(i+=' class="'+e.cssClass+'"'),e.selected&&(i+=' selected="selected"'),i+=">"+(e.text||e.value||"")+"</option>"})),i+="</select>",this.span.innerHTML=i,this.dropdown=this.span.firstChild,this.callback&&this.onSelect(this.callback),this.dropdown.selectedIndex<=0&&t>=0&&t<this.dropdown.options.length&&(this.dropdown.selectedIndex=t)},enable:function(){return this.dropdown.enable(),this.dropdown.selectedIndex<=0&&this._tmpSelectedIndex<this.dropdown.options.length&&(this.dropdown.selectedIndex=this._tmpSelectedIndex,this._tmpSelectedIndex>0)},disable:function(){this.dropdown.disable(),this._tmpSelectedIndex=this.dropdown.selectedIndex,this.dropdown.selectedIndex=0},getElement:function(){return this.span},onSelect:function(e){var t=this;this.callback=e;var i=["change"];browser.isGecko&&i.push("keyup"),i.each((function(i){t.dropdown.observe(i,(function(){e(),t._tmpSelectedIndex=t.dropdown.selectedIndex}))}))},onFocus:function(e){var t=this;this.dropdown.observe("focus",(function(){e(),-1==t.dropdown.selectedIndex&&t._tmpSelectedIndex<t.dropdown.options.size()&&(t.dropdown.selectedIndex=t._tmpSelectedIndex)}))},onBlur:function(e){this.dropdown.observe("blur",e)},getSelectedValue:function(){return this.dropdown.selectedIndex>=0?this.dropdown.options[this.dropdown.selectedIndex].value:""},getSelectedClass:function(){return this.dropdown.selectedIndex>=0?this.dropdown.options[this.dropdown.selectedIndex].className:""},getSelectedOption:function(){return this.dropdown.selectedIndex>=0?this.dropdown.options[this.dropdown.selectedIndex].innerHTML:""}}),t.FuzzyDatePicker=Class.create({initialize:function(e){if(e&&!e.hasClassName("initialized")){if(this.__input=e,this.__input.hide(),this.__fuzzyInput=$(this.__input.name+"_entered"),this.__fuzzyInput&&(this.__recordBoth=!0),this.__fuzzyInput&&this.__fuzzyInput.value)this.__date=JSON.parse(this.__fuzzyInput.value||"{}");else if(this.__input.alt){var t=new Date(this.__input.alt);this.__date={year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate()}}else this.__date={};this.container=new Element("div",{class:"fuzzy-date-picker"}),this.__input.insert({before:this.container});for(var i=(this.__input.title||"yyyy-MM-dd").split(/\W+/),s=0;s<i.length;++s)switch(i[s][0]){case"y":this.container.insert(this.createYearDropdown());break;case"M":this.container.insert(this.createMonthDropdown());break;case"d":this.container.insert(this.createDayDropdown());break}this.container.observe("datepicker:date:changed",this.onProgrammaticUpdate.bind(this)),this.onProgrammaticUpdate(),this.__input.addClassName("initialized"),Event.fire(document,"xwiki:dom:updated",[this.container])}},onProgrammaticUpdate:function(){this.yearSelected(),this.monthSelected(),this.updateDate()},createYearDropdown:function(){this.yearSelector=new t.FuzzyDatePickerDropdown({name:"year"});var e=(new Date).getYear()+1900,i=this.__date.hasOwnProperty("range")&&this.__date.range.hasOwnProperty("years")?this.__date.range.years:1,s=this.__date.hasOwnProperty("year")?this.__date.year:null,n=[];s>e&&n.push({value:s,selected:!0});for(var o=e;o>=1900;--o)n.push({value:o,selected:s==o&&i<=1}),o%10==0&&n.push({value:o+"s",cssClass:"decade",text:o+"s",selected:s==o&&i>1});var a=function(e){var t=e+100;null!=s&&s>=e&&s<t&&1==i&&n.push({value:s,selected:!0});var o=null!=s&&s>=e&&s<t&&i>1;n.push({value:e+"s",cssClass:"century",selected:o})};return a(1800),a(1700),a(1600),a(1500),null!=s&&s<1500&&n.push({value:s,selected:!0}),this.yearSelector.populate(n),this.yearSelector.onSelect(this.yearSelected.bind(this)),this.yearSelector.getElement()},yearSelected:function(){this.yearSelector&&(this.yearSelector.getSelectedValue()>0&&this.monthSelector&&this.monthSelected(),this.updateDate())},createMonthDropdown:function(){return this.monthSelector=new t.FuzzyDatePickerDropdown({name:"month"}),this.monthSelector.populate(this.getZeroPaddedValueRange(1,12,this.__date.month)),this.monthSelector.onSelect(this.monthSelected.bind(this)),this.monthSelector.getElement()},monthSelected:function(){this.monthSelector&&(this.monthSelector.getSelectedValue()>0&&this.daySelector&&this.daySelector.populate(this.getAvailableDays()),this.updateDate())},createDayDropdown:function(){return this.daySelector=new t.FuzzyDatePickerDropdown({name:"day"}),this.daySelector.populate(this.getZeroPaddedValueRange(1,31,this.__date.day)),this.daySelector.onSelect(this.updateDate.bind(this)),this.daySelector.getElement()},getAvailableDays:function(){var e=1*this.yearSelector.getSelectedValue(),t=1*this.monthSelector.getSelectedValue(),i=0;return[1,3,5,7,8,10,12].indexOf(t)>=0?i=31:[4,6,9,11].indexOf(t)>=0?i=30:2==t&&(i=e%4!=0||e%100==0&&e%400!=0?28:29),this.getZeroPaddedValueRange(1,i)},getZeroPaddedValue:function(e){return e?("0"+e).slice(-2):"01"},getZeroPaddedValueRange:function(e,t,i){var s=[];if(e<=t)for(var n=e;n<=t;++n)s.push({value:n,text:("0"+n).slice(-2),selected:i==n});else for(n=t;n<=e;--n)s.push({value:n,text:("0"+n).slice(-2),selected:i==n});return s},updateDate:function(){var e={},t=this.yearSelector.getSelectedValue(),i=t.match(/(\d\d\d\d)s$/);if(i){var s="century"==this.yearSelector.getSelectedClass()?100:10;e.range={years:s},e.year=parseInt(i[1])}else""!=t&&(e.year=parseInt(t));if(t>0){var n=this.monthSelector&&this.monthSelector.getSelectedValue();if(n>0){e.month=parseInt(this.monthSelector.getSelectedOption());var o=this.daySelector&&this.daySelector.getSelectedValue();o>0&&(e.day=parseInt(this.daySelector.getSelectedOption()))}}var a=JSON.stringify(e);this.__recordBoth?a!=this.__fuzzyInput.value&&(this.__fuzzyInput.value=JSON.stringify(e),this.__input.value=t&&!t.match(/\d\d\d\ds$/)?t+"-"+this.getZeroPaddedValue(n)+"-"+this.getZeroPaddedValue(o):"",this.__input.alt=t&&!t.match(/\d\d\d\ds$/)?t+"-"+this.getZeroPaddedValue(n)+"-"+this.getZeroPaddedValue(o)+"T00:00:00Z":"",this.__input.fire("xwiki:date:changed")):a!=this.__input.value&&(this.__input.value=JSON.stringify(e),this.__input.alt=t&&!t.match(/\d\d\d\ds$/)?t+"-"+this.getZeroPaddedValue(n)+"-"+this.getZeroPaddedValue(o)+"T00:00:00Z":"",this.__input.fire("xwiki:date:changed"))}});var i=function(t){return(t&&t.memo.elements||[$("body")]).each((function(t){(t.hasClassName("fuzzy-date")?[t]:t.select(".fuzzy-date")).each((function(t){t.__datePicker||(t.__datePicker=new e.widgets.FuzzyDatePicker(t))}))})),!0};return XWiki.domIsLoaded&&i()||document.observe("xwiki:dom:loaded",i),document.observe("xwiki:dom:updated",i),e}((PhenoTips=function(e){(e.widgets=e.widgets||{}).HelpButton=Class.create({infoServices:{xHelpButton:{hint:"How to enter this information",callback:function(e){e.helpBox.content.update(e._information||"")}},"phenotype-info":{hint:"About this phenotype",vocabulary:"hpo",database:{name:"The Human Phenotype Ontology (HPO)",link:"http://human-phenotype-ontology.github.io/",citation:"The Human Phenotype Ontology project: linking molecular biology and disease through phenotype data. Sebastian Köhler, Sandra C Doelken, Christopher J. Mungall, Sebastian Bauer, Helen V. Firth, et al. Nucl. Acids Res. (1 January 2014) 42 (D1): D966-D974 doi:10.1093/nar/gkt1026",version:"releases/2017-12-12"},callback:function(t,i){var s=t.helpBox.content,n=function(e,t,i){return new Element(e,t&&{class:t}||{}).update(i||"")};s.update(n("span","info").insert(n("span","key").update(i.id)).insert(" ").insert(n("span","value").update(i.name_translated))),i.def_translated&&s.insert(n("p").update(i.def_translated.replace(/\s*\n\s*/," ").replace(/`([^`]+)`\s+\(([A-Z]+:[0-9]+)`?\)/g,'<em title="$2">$1</em>')));var o={synonym:"Also known as",parents:"Is a type of"},a=n("dl");for(var r in o)i[r]&&(a.insert(n("dt","",o[r])),i[r].each((function(e){a.insert(n("dd","",e.name_translated||e))})));a.firstDescendant()&&s.insert(a);var l=t.icon.getAttribute("data-source")&&$(t.icon.getAttribute("data-source"))||$("quick-phenotype-search")||$$("input.suggest-hpo")[0];if(e.widgets.OntologyBrowser&&l){var d=new Element("a",{class:"button",href:"#"}).update("Browse related terms…");d._id=i.id,d.observe("click",(function(t){t.stop();var i=l._suggest,s={};"undefined"!=typeof isPhenotypeSelected&&(s={isTermSelected:isPhenotypeSelected,unselectTerm:unselectPhenotype}),d._obrowser=new e.widgets.OntologyBrowser(i,null,s),d._obrowser.show(d._id)})),s.insert(n("div","term-tools").insert(d.wrap("span",{class:"buttonwrapper"})))}}},"phenotype-qualifier-info":{hint:"About this phenotype qualifier",vocabulary:"hpo",database:{name:"The Human Phenotype Ontology (HPO)",link:"http://human-phenotype-ontology.github.io/",citation:"The Human Phenotype Ontology project: linking molecular biology and disease through phenotype data. Sebastian Köhler, Sandra C Doelken, Christopher J. Mungall, Sebastian Bauer, Helen V. Firth, et al. Nucl. Acids Res. (1 January 2014) 42 (D1): D966-D974 doi:10.1093/nar/gkt1026",version:"releases/2017-12-12"},callback:function(e,t){var i=e.helpBox.content,s=function(e,t,i){return new Element(e,t&&{class:t}||{}).update(i||"")};i.update(s("span","info").insert(s("span","key").update(t.id)).insert(" ").insert(s("span","value").update(t.name_translated))),t.def_translated&&i.insert(s("p").update(t.def_translated.replace(/\s*\n\s*/," ").replace(/`([^`]+)`\s+\(([A-Z]+:[0-9]+)`?\)/g,'<em title="$2">$1</em>')))}},"omim-disease-info":{hint:"About this disease",vocabulary:"omim",database:{name:"Online Mendelian Inheritance in Man (OMIM)",link:"http://www.omim.org/",citation:"Online Mendelian Inheritance in Man, OMIM®. McKusick-Nathans Institute of Genetic Medicine, Johns Hopkins University (Baltimore, MD)",version:"2017-05-08T16:25:23.918Z"},callback:function(e,t){var i=e.helpBox.content,s=function(e,t,i){return new Element(e,t&&{class:t}||{}).update(i||"")};i.update(s("span","info").insert(s("span","key").update((t.symbol||"")+t.id)).insert(" ").insert(s("span","value").update(t.name_translated)));var n={short_name:"",synonym:"Also known as",included_name:"Includes"},o=s("dl");for(var a in n)t[a]&&t[a].length>0&&(o.insert(s("dt","",n[a])),t[a].each((function(e){o.insert(s("dd","",e.label||e))})));o.firstDescendant()&&i.insert(o);var r=new Element("a",{class:"button",href:"http://www.omim.org/entry/"+t.id,target:"_blank"}).update("Read about it on OMIM.org…");if(i.insert(s("div","term-tools").insert(r.wrap("span",{class:"buttonwrapper"}))),r.observe("click",(function(e){e.stop(),window.open(r.href)})),t.gene_reviews_link){var l=new Element("a",{class:"button",href:t.gene_reviews_link,target:"_blank"}).update("Read about it on Gene Reviews…");i.insert(s("div","term-tools").insert(l.wrap("span",{class:"buttonwrapper"}))),l.observe("click",(function(e){e.stop(),window.open(l.href)}))}}},"ordo-disease-info":{hint:"About this disease",vocabulary:"ordo",database:{name:"Orphanet Rare Disease Ontology",link:"http://www.orpha.net/",citation:"Orphadata: Free access data from Orphanet. © INSERM 1997",version:"2.3"},externalDBs:[{name:"Ensembl",url:"http://useast.ensembl.org/Homo_sapiens/Gene/Compara_Tree?g=",field:"ensembl_id"},{name:"GenAtlas",url:"http://genatlas.medecine.univ-paris5.fr/fiche.php?symbol=",field:"genatlas_id"},{name:"HGNC",url:"http://www.genenames.org/cgi-bin/gene_symbol_report?hgnc_id=",field:"hgnc_id"},{name:"ICD-10",url:"http://icdlist.com/icd-10/",field:"icd-10_id"},{name:"IUPHAR",url:"http://guidetopharmacology.org/GRAC/ObjectDisplayForward?objectId=",field:"iuphar_id"},{name:"MedDRA",url:"http://purl.bioontology.org/ontology/MEDDRA/",field:"meddra_id"},{name:"MeSH",url:"https://www.ncbi.nlm.nih.gov/mesh/",field:"mesh_id"},{name:"OMIM",url:"http://www.omim.org/entry/",field:"omim_id"},{name:"UniProt",url:"http://www.uniprot.org/uniprot/",field:"swissprot_id"},{name:"UMLS",url:"https://uts.nlm.nih.gov/metathesaurus.html?cui=",field:"umls_id"}],callback:function(e,t){var i=e.helpBox.content,s=function(e,t,i){return new Element(e,t&&{class:t}||{}).update(i||"")};i.update(s("span","info").insert(s("span","key").update(t.id)).insert(" ").insert(s("span","value").update(t.name_translated))),t.def_translated&&i.insert(s("p").update(t.def_translated.replace(/\s*\n\s*/," ")));var n={alternative_term:"Also known as",parents:"Is a type of"},o=s("dl");for(var a in n)t[a]&&(o.insert(s("dt","",n[a])),t[a].each((function(e){o.insert(s("dd","",e.name_translated||e))})));o.firstDescendant()&&i.insert(o);var r=s("div","term-tools");this.externalDBs.each((function(e){var i=t[e.field];i&&(i.each||(i=[i]),i.each((function(t){r.insert(new Element("a",{href:e.url+t,class:"button"}).update(e.name+": "+t).wrap("span",{class:"buttonwrapper"}))})))})),r.select("a").each((function(e){e.observe("click",(function(t){t.stop(),window.open(e.href)}))})),r.firstDescendant()&&i.insert(r)}},"gene-info":{hint:"About this gene",vocabulary:"hgnc",database:{name:"HUGO Gene Nomenclature Committee's GeneNames (HGNC)",link:"http://www.genenames.org/",citation:"HGNC Database, HUGO Gene Nomenclature Committee (HGNC), EMBL Outstation - Hinxton, European Bioinformatics Institute, Wellcome Trust Genome Campus, Hinxton, Cambridgeshire, CB10 1SD, UK",version:"2017-07-17T02:26:39.671Z"},externalDBs:[{name:"GENECARDS",url:"http://www.genecards.org/cgi-bin/carddisp.pl?gene=",field:"genecards_id"},{name:"OMIM",url:"http://www.omim.org/entry/",field:"omim_id"},{name:"Entrez",url:"http://www.ncbi.nlm.nih.gov/gene/?term=",field:"entrez_id"},{name:"RefSeq",url:"http://www.ncbi.nlm.nih.gov/nuccore/",field:"refseq_accession"},{name:"Ensembl",url:"http://useast.ensembl.org/Homo_sapiens/Gene/Compara_Tree?g=",field:"ensembl_gene_id"},{name:"Gene panels",url:"https://www.ncbi.nlm.nih.gov/gtr/all/tests/?term=",field:"genecards_id"}],callback:function(e,t){var i=e.helpBox.content,s=function(e,t,i){return new Element(e,t&&{class:t}||{}).update(i||"")};i.update(s("span","info").insert(s("span","key").update(t.symbol)).insert(" ").insert(s("span","value").update(t.name_translated)));var n={alias_symbol:"Aliases",prev_symbol:"Previous symbols",gene_family:"Gene family"},o=s("dl");for(var a in n)t[a]&&t[a].length>0&&(o.insert(s("dt","",n[a])),"[object Array]"===Object.prototype.toString.call(t[a])?t[a].each((function(e){o.insert(s("dd","",e.name_translated||e))})):o.insert(s("dd","",t[a])));o.firstDescendant()&&i.insert(o);var r=s("div","term-tools");this.externalDBs.each((function(e){var i=t[e.field];i&&(i.each||(i=[i]),i.each((function(t){r.insert(new Element("a",{href:e.url+t,class:"button"}).update(e.name+": "+t).wrap("span",{class:"buttonwrapper"}))})))})),r.select("a").each((function(e){e.observe("click",(function(t){t.stop(),window.open(e.href)}))})),r.firstDescendant()&&i.insert(r)}}},initialize:function(e){for(var t in this.icon=e,this._information=this.icon._information||this.icon.title,this.infoServices)this.icon.hasClassName(t)&&(this._builder=this.infoServices[t],this.icon.title=this.infoServices[t].hint||"");this._builder&&(this.icon.observe("click",this.toggleHelp.bindAsEventListener(this)),this.hideAllHelpOnOutsideClick=this.hideAllHelpOnOutsideClick.bindAsEventListener(this))},toggleHelp:function(){!this.helpBox||this.helpBox.hasClassName("hidden")?(this.showHelp(),document.observe("click",this.hideAllHelpOnOutsideClick)):this.hideHelp()},hideAllHelpOnOutsideClick:function(e){e.findElement(".xTooltip")||e.findElement(".xHelpButton")||(this.hideHelp(),document.stopObserving("click",this.hideAllHelpOnOutsideClick))},hideHelp:function(e){e&&e.stop(),this.helpBox&&(this.helpBox.hasClassName("error")?(this.helpBox.remove(),delete this.helpBox):this.helpBox.addClassName("hidden"))},showHelp:function(){this.helpBox||this.createHelpBox(),$$("div.xTooltip:not(.hidden)").invoke("_hideHelp"),this.helpBox.removeClassName("hidden")},createHelpBox:function(){this.helpBox=new Element("div",{class:"hidden xTooltip"}),this.helpBox._behavior=this,this.helpBox._hideHelp=function(){this._behavior.hideHelp()}.bind(this.helpBox),this.helpBox.content=new Element("div"),this.helpBox.insert(this.helpBox.content),this._builder.service||this._builder.vocabulary?this.createHelpContentFromService():this._builder.callback&&this._builder.callback(this);var e=new Element("span",{class:"hide-tool",title:"Hide"});e.update("×"),e.observe("click",this.hideHelp.bindAsEventListener(this)),this.helpBox.insert({top:e}),this.icon.insert({after:this.helpBox})},createHelpContentFromService:function(){var e=this,t=XWiki.contextPath+"/rest/vocabularies/"+e._builder.vocabulary+"/"+e._information;new Ajax.Request(t,{parameters:{id:e._information},method:"get",onCreate:function(){e.helpBox.content.update(new Element("span",{class:"hint temporary"}).update("Loading…"))},onSuccess:function(t){e._builder.callback(e,t.responseJSON)},onFailure:function(t){e.helpBox.addClassName("error"),e.helpBox.down(".temporary").remove(),e.helpBox.insert("Failed to retrieve information about __subject__".replace("__subject__",e._information)+" : "+t.statusText)}}),this.addDatabaseCreditInfo()},addDatabaseCreditInfo:function(){var e="Current version: "+this._builder.database.version,t=this._builder.database.citation.concat(". ").concat(e),i=new Element("a",{class:"reference",href:this._builder.database.link,target:"_blank",title:t}).update(this._builder.database.name),s=new Element("div",{class:"hint"}).update(i.wrap("span",{class:"reference-wrapper"}));this.helpBox.insert({top:s}),i.observe("click",(function(e){e.stopPropagation()}))}});var t=function(t){return(t&&t.memo.elements||[$("body")]).each((function(t){(t.hasClassName("xHelpButton")?[t]:t.select(".xHelpButton")).each((function(t){t.__helpController||(t.__helpController=new e.widgets.HelpButton(t))}))})),!0};return XWiki.domIsLoaded&&t()||document.observe("xwiki:dom:loaded",t),document.observe("xwiki:dom:updated",t),e}((PhenoTips=function(e){return(e.widgets=e.widgets||{}).UnitConverter=Class.create({CONVERSION_META:{weight:{imperial_units:["lb","oz"],metric_unit:"kg",inter_unit_scale:16,inter_system_scale:.0283495},length:{imperial_units:["ft","in"],metric_unit:"cm",inter_unit_scale:12,inter_system_scale:2.54}},DEFAULT_UNIT_SYSTEM:"metric",initialize:function(e,t,i,s,n){if(this._selector=t,this._container=e||document.documentElement,this._selector&&i){this.crtUnitSystem=n||this.DEFAULT_UNIT_SYSTEM,this.initializeElements=this.initializeElements.bind(this),this.attachConverter=this.attachConverter.bind(this),this.generateTrigger(i,s||"bottom"),this.initializeElements();var o=this;document.observe("xwiki:dom:updated",(function(e){e.memo&&e.memo.elements&&e.memo.elements.each(o.initializeElements.bind(o))}))}},generateTrigger:function(e,t){this._trigger=new Element("select",{class:"unit-system-selector"});var i=new Element("option",{value:"metric"}).update("Metric units ("+this.CONVERSION_META.weight.metric_unit+", "+this.CONVERSION_META.length.metric_unit+")");"metric"==this.crtUnitSystem&&(i.selected="selected");var s=new Element("option",{value:"imperial"}).update("Imperial units ("+this.CONVERSION_META.weight.imperial_units.join(" / ")+", "+this.CONVERSION_META.length.imperial_units.join(" / ")+")");"imperial"==this.crtUnitSystem&&(s.selected="selected"),this._trigger.insert(i).insert(s),insertionInfo={},insertionInfo[t]=this._trigger,e.insert(insertionInfo);var n=this;this._trigger.observe("change",(function(e){n.crtUnitSystem=n._trigger.options[n._trigger.selectedIndex].value,n.switchUnits(n.crtUnitSystem)}))},initializeElements:function(e){container=e||this._container,container.__unitSwitcher||!container.up(".measurements")&&!container.hasClassName("measurements")||(container.__unitSwitcher=this,container.select(this._selector).each(this.attachConverter),this.switchUnits(this.crtUnitSystem,container))},switchUnits:function(e,t){container=t||this._container,container.select(".unit-conversion-values .unit-type").each((function(t){t.hasClassName(e)?t.show():t.hide()}))},attachConverter:function(e){if("input"==e.tagName.toLowerCase()&&"text"==e.type){var t=e.next(".unit"),i=new Element("div",{class:"unit-conversion-values"}),s=e.up(".weight")?"weight":"length";i.addClassName(s),i._meta=this.CONVERSION_META[s];var n=this.metricToImperial(i._meta,parseFloat(e.value)||0),o=e.up(".metric");o?(o.addClassName("unit-type"),o.insert({after:i})):((o=new Element("div",{class:"unit-type metric"})).insert(e).insert(t||i._meta.metric_unit),e.insert({after:i}));var a=new Element("div",{class:"unit-type imperial"});i.insert(o).insert(a),i._meta.imperial_units.each((function(e){a.insert(new Element("label").insert(new Element("input",{style:"width: auto",name:e,type:"text",size:3,value:n[e]||""})).insert(e))})),this.enableSyncValues(i)}},enableSyncValues:function(e){var t=this;e.select(".imperial input").invoke("observe","change",(function(i){t.syncMetricWithImperial(e)})),e.select(".metric input").invoke("observe","change",(function(i){t.syncImperialWithMetric(e)}))},syncMetricWithImperial:function(e){var t=e.down(".metric input");t.value=this.imperialToMetric(e._meta,parseFloat(e.down('.imperial input[name="'+e._meta.imperial_units[0]+'"]').value)||0,parseFloat(e.down('.imperial input[name="'+e._meta.imperial_units[1]+'"]').value)||0)||"",Event.fire(t,"phenotips:measurement-updated")},syncImperialWithMetric:function(e){var t=this.metricToImperial(e._meta,parseFloat(e.down(".metric input").value)||0);e._meta.imperial_units.each((function(i){e.down('.imperial input[name="'+i+'"]').value=t[i]||""}))},metricToImperial:function(e,t){var i={},s=t/e.inter_system_scale,n=Math.floor(s/e.inter_unit_scale);return(s-=n*e.inter_unit_scale)&&(s=s.toFixed(2)),i[e.imperial_units[0]]=n,i[e.imperial_units[1]]=s,i},imperialToMetric:function(e,t,i){return((e.inter_unit_scale*t+i)*e.inter_system_scale).toFixed(2)}}),e}(PhenoTips||{}))||{}))||{}),function(){var e=function(e){(e&&e.memo.elements||[$("body")]).each((function(e){e.select("input.suggestUsersAndGroups").each((function(e){if(!e.hasClassName("initialized")){var t={script:XWiki.contextPath+"/rest/principals/suggest",noresults:"No users or groups found"};new XWiki.widgets.UserPicker(e,t),e.addClassName("initialized")}}))}))};XWiki.domIsLoaded&&e()||document.observe("xwiki:dom:loaded",e),document.observe("xwiki:dom:updated",e)}(),PhenoTips=function(e){return(e.widgets=e.widgets||{}).SegmentedBar=Class.create({options:{segments:5,displayValue:!0},initialize:function(e,t){this.value=e,this.options=Object.extend(Object.clone(this.options),t||{})},generateSegmentedBar:function(){if(!(this.value>1||this.value<0)){for(var e=new Element("div",{class:"segmented-bar",title:Math.round(100*this.value)+"%"||""}),t=1/this.options.segments,i=0;i<this.options.segments;++i){var s=100*Math.min(Math.max((this.value-i*t)/t,0),1),n=new Element("span",{class:"segmented-unit"}),o=new Element("span",{class:"segmented-unit-fill"});o.setStyle({width:s+"%"}),n.insert(o),e.insert(n)}return this.options.displayValue&&e.insert(" "+Math.round(100*this.value)+"%"),e}console}}),e}(PhenoTips||{}),XWiki=function(e){(e.widgets=e.widgets||{}).UniquenessValidator=Class.create({initialize:function(t){this.entityType=$("entity-type")&&$("entity-type").value,this.entityType&&(this.input=t,this.valid=!0,this.state="NEW",this.request=0,this.value=t.value,this.serviceUrl=new e.Document("CheckID","PhenoTips").getURL("get"),this.input.__validation||(this.input.__validation=new LiveValidation(this.input,{validMessage:"",wait:500})),this.input.__validation.add(this.validate.bind(this)))},check:function(){this.input.value!=this.value&&(this.value=this.input.value,this.state="CHECKING",new Ajax.Request(this.serviceUrl,{parameters:{outputSyntax:"plain",eid:this.value,id:e.Model.serialize(new e.DocumentReference(e.currentDocument.wiki,e.currentDocument.space,e.currentDocument.page)),entity:this.entityType},on200:this.self.bindAsEventListener(this),on403:this.empty.bindAsEventListener(this),on404:this.available.bindAsEventListener(this),on409:this.exists.bindAsEventListener(this),onComplete:this.responded.bindAsEventListener(this)}))},validate:function(e){return"DONE"==this.state&&this.value==e&&(this.valid||Validate.fail("This identifier already exists")),this.check(),!0},self:function(){this.valid=!0},available:function(){this.valid=!0},empty:function(){this.valid=!1},exists:function(){this.valid=!1},responded:function(){this.state="DONE",this.input.__validation.validate()}});var t=function(t){return(t&&t.memo.elements||[$("body")]).each((function(t){t.select("input.check-unique, .external_id input").each((function(t){t.__uniqueness_validator||(t.__uniqueness_validator=new e.widgets.UniquenessValidator(t))}))})),!0};return e.domIsLoaded&&t()||document.observe("xwiki:dom:loaded",t),document.observe("xwiki:dom:updated",t),e}((XWiki=function(e){(e.widgets=e.widgets||{}).SingleSubmitForm=Class.create({initialize:function(e){this.form=e,this.form.observe("submit",this.lockForm.bindAsEventListener(this)),window.addEventListener("pageshow",this.unlockForm.bindAsEventListener(this))},lockForm:function(e){this.submitted?e.stop():this.submitted=!0},unlockForm:function(e){this.submitted=!1}});var t=function(t){return(t&&t.memo.elements||[$("body")]).each((function(t){t.select("form.x-single-submit-form").each((function(t){t.__singleSubmit||(t.__singleSubmit=new e.widgets.SingleSubmitForm(t))}))})),!0};return e.domIsLoaded&&t()||document.observe("xwiki:dom:loaded",t),document.observe("xwiki:dom:updated",t),e}(XWiki||{}))||{}),PhenoTips=function(e){return(e.widgets=e.widgets||{}).DetailsDialogGroup=Class.create({initialize:function(e,t){this._dataName=e,this._qualifierNo=0;var i=t||{};this._allowMultiDialogs=i.allowMultiDialogs||!1,this._disableTermDelete=i.disableTermDelete||!1,this._doneTypingInterval=i.doneTypingInterval||500,this._dialogOptions=[],this._dialogMap={},this._crtFocus=null,this._buildEmptyContainer(),this._addDialogDeletedListener(),this._addDialogFocusManagers(),this._attachKeyUpObserver()},getID:function(){return this._termID},get:function(){return this._qualifiersContainer},withLabel:function(e,t,i){var s=t&&t.strip()||"",n=e&&e.strip()||"";if(this._termID=s,this._label=n||s,""===this._termID)return this;this._qualifiersContainer.id=this._dataName+"_"+this._termID;var o=this._qualifiersContainer.down("span.term-data"),a='<label class="label-field">';return a+='<input id="status_'+this._termID+'" class="term-status" name="'+this._dataName+'" type="checkbox"> ',a+=this._label+'</label><input class="term-id" type="hidden" value="'+this._termID+'">',o.innerHTML=a,this._addTooltip(i),this._initButtons(),this},dialogsAddNumericSelect:function(e){return this._dialogOptions.push((function(t){t.withNumericSelect(e)})),this},dialogsAddItemSelect:function(e){return this._dialogOptions.push((function(t){t.withItemSelect(e)})),this},dialogsAddRadioList:function(e,t){return this._dialogOptions.push((function(i){i.withRadioList(e,t)})),this},dialogsAddTextBox:function(e,t){return this._dialogOptions.push((function(i){i.withTextBox(e,t)})),this},dialogsAddCustomElement:function(e,t,i){return this._dialogOptions.push((function(s){s.withQualifierElement(e,t,i)})),this},dialogsAddDeleteAction:function(){return this._dialogOptions.push((function(e){e.withDeleteAction()})),this},clearDialogOptions:function(){return this._dialogOptions=[],this},isAffected:function(){return this._qualifiersContainer.down("input.term-status").checked},initAffected:function(e){this.affected(!0),this.addDialog(e),this._allowMultiDialogs&&this._addDetailsClickListener()},affected:function(e){this._qualifiersContainer.down("input.term-status").checked=e},getValues:function(){var e=[];for(var t in this._dialogMap)this._dialogMap.hasOwnProperty(t)&&e.push(this._dialogMap[t].getValues());return{id:this._termID,label:this._label,affected:this.isAffected(),qualifiers:e}},setValues:function(e){if(e&&(this._clearDetails(),void 0===e.id||this._termID===e.id)){if(void 0!==e.label){var t=e.label&&e.label.strip();this._label!==t&&(this._label=t||this._termID)}e.affected&&e.qualifiers&&e.qualifiers.length>0&&(this.affected(e.affected),this._setQualifiers(e.qualifiers))}},clearDetails:function(){this._clearDetails(),Event.fire(this._qualifiersContainer,this._dataName+":term:cleared")},addDialog:function(e){var t=this._addDialog();return this._dialogMap[t.getID()]=t,this._applyDialogOptions(t),!this._allowMultiDialogs&&this._removeDetailsClickListener(),this._dialogHolder.show(),e||Event.fire(this._qualifiersContainer,this._dataName+":dialog:added",{element:t.getDialog()}),t},size:function(){var e=this._qualifiersContainer.select("div.summary-item");return e?e.length:0},_setQualifiers:function(e){var t=this;e.forEach((function(e){t.addDialog(!0).setValues(e).blur()})),this._allowMultiDialogs&&this._addDetailsClickListener()},_clearDetails:function(){this._qualifierNo=0,this._dialogHolder.descendants().forEach((function(e){e.stopObserving()})),this._dialogMap={},this._dialogHolder.update(),this._dialogHolder.hide(),this.affected(!1),this._removeDetailsClickListener()},_buildEmptyContainer:function(){this._qualifiersContainer=new Element("table",{class:"summary-group "+this._dataName+"-summary-group"}),this._qualifiersContainer.name=this._dataName,this._dialogHolder=new Element("td",{class:"dialog-holder"});var e=new Element("tbody").insert(new Element("tr",{class:"term-holder"}).insert(new Element("td").insert(new Element("span",{class:"term-data"})).insert(new Element("span",{class:"delete-button-holder"})))).insert(new Element("tr").insert(this._dialogHolder)).insert(new Element("tr").insert(new Element("td",{class:"add-button-holder"})));this._qualifiersContainer.insert(e),this._dialogHolder.hide()},_addTooltip:function(t){if(t){var i=new Element("span",{class:"fa fa-info-circle xHelpButton "+t,title:this.getID()});new e.widgets.HelpButton(i),this._qualifiersContainer.down("span.term-data").insert(i)}},_initButtons:function(){this._addButtonHolder=this._qualifiersContainer.down("td.add-button-holder"),this._addDetailsButton=new Element("span",{id:"add_details_"+this._termID,class:"patient-menu-button patient-details-add"}).update('<i class="fa fa-plus"></i> ...'),this._addButtonHolder.insert(this._addDetailsButton),this._deleteButtonHolder=this._qualifiersContainer.down("span.delete-button-holder"),this._disableTermDelete?this._deleteButtonHolder.hide():(this._deleteButton=new Element("span",{id:"delete_term_"+this._termID,class:"action-done patient-term-delete clickable"}).update("✖"),this._deleteButtonHolder.insert(this._deleteButton),this._addTermDeleteListener()),this._addButtonHolder.hide(),this._addOnTermSelectListener()},_applyDialogOptions:function(e){return this._dialogOptions.forEach((function(t){t(e)})),e},_addDialog:function(){var t=this._termID+"_"+this._qualifierNo++;return new e.widgets.DetailsDialog(t,this._dataName,this._dialogHolder).attach()},_addTermDeleteListener:function(){var e=this;this._deleteButton.observe("click",(function(){var t=e._qualifiersContainer.down("input.term-id"),i=t&&t.value;e._clearDetails(),e._removeTermDeleteListener(),e._qualifiersContainer.remove(),Event.fire(e._qualifiersContainer,e._dataName+":term:deleted",{id:i})})),this._deleteButtonHolder.show()},_removeTermDeleteListener:function(){this._deleteButton.stopObserving("click"),this._deleteButtonHolder.hide()},_addOnTermSelectListener:function(){var e=this,t=this._qualifiersContainer.down("input.term-status");t.observe("click",(function(e){e.stopPropagation()})),t.observe("change",(function(i){i.stop(),t.checked?(e._allowMultiDialogs&&e._addDetailsClickListener(),e.addDialog(!1)):(e._removeDetailsClickListener(),e.clearDetails()),Event.fire(e._qualifiersContainer,e._dataName+":status:changed",{id:e._termID})}))},_addDetailsClickListener:function(){var e=this;this._addDetailsButton.observe("click",(function(t){t.stop(),e.addDialog(!1)})),this._addButtonHolder.show()},_removeDetailsClickListener:function(){this._addDetailsButton.stopObserving("click"),this._addButtonHolder.hide()},_addDialogDeletedListener:function(){var e=this;this._dialogHolder.observe(e._dataName+":dialog:deleted",(function(t){this.down()?t.memo&&t.memo.id&&delete e._dialogMap[t.memo.id]:(t.stop(),e.clearDetails())}))},_addDialogFocusManagers:function(){var e=this;document.observe(this._dataName+":dialog:added",(function(t){var i=t.memo&&t.memo.element;i&&(i.up("td.dialog-holder")===e._dialogHolder?(e._crtFocus&&e._blur(e._crtFocus),e._crtFocus=i,e._focus(e._crtFocus)):e._crtFocus&&(e._blur(e._crtFocus),e._crtFocus=null))})),document.observe("click",(function(t){if(t.findElement("td.dialog-holder")===e._dialogHolder){var i=t.findElement("div.summary-item");e._crtFocus?e._crtFocus!==i&&(e._blur(e._crtFocus),e._crtFocus=i||null,i&&e._focus(e._crtFocus)):(e._crtFocus=i||null,i&&e._focus(e._crtFocus))}else e._crtFocus&&"term-status"!==t.target.className&&(e._blur(e._crtFocus),e._crtFocus=null)}))},_blur:function(e){var t=e.down("input").value,i=this._dialogMap[t];i&&(i.blur(),Event.fire(this._qualifiersContainer,this._dataName+":dialog:blurred"))},_focus:function(e){var t=e.down("input").value,i=this._dialogMap[t];i&&(i.focus(),Event.fire(this._qualifiersContainer,this._dataName+":dialog:focused"))},_attachKeyUpObserver:function(){var e,t=this;this._dialogHolder.observe("keyup",(function(s){clearTimeout(e),e=setTimeout(i.bind(t,s),t._doneTypingInterval)})),this._dialogHolder.observe("keydown",(function(){clearTimeout(e)}));var i=function(e){e.target.hasClassName("qualifier-notes")&&Event.fire(this._qualifiersContainer,this._dataName+":notes:updated",{target:e.target})}}}),e}((PhenoTips=function(e){return(e.widgets=e.widgets||{}).DetailsDialog=Class.create({initialize:function(e,t,i){this._container=i,this._dataName=t,this._elementID=e,this._qualifierMap={},this._buildEmptyDialog()},withNumericSelect:function(e){if(!(e=e||{}).from||!e.to)return this;var t=e.from,i=e.to,s=e.step||1,n=e.majorStepSize||null,o=e.inputSourceClass||"",a=new Element("span"),r='<select name="'+this._dataName+'" class="'+o+'"><option value=""></option>';n&&(r+='<option value="<'+t+'">before '+t+"</option>");for(var l=1,d=t,u=t;u<=i;u+=s,l++)n&&l===n&&(l=0,r+='<option value="'+d+"-"+u+'">'+d+"-"+u+"</option>",d=u+s),r+='<option value="'+u+'">'+u+"</option>";return n&&(r+='<option value=">'+i+'">after '+i+"</option></select>"),a.innerHTML=r,a._getValue=this._defaultGetSelectValueFx(a),a._setValue=this._setSelectValueFx(a,e.storedToDisplayedMapper),a._addValue=this._addSelectValueFx(a,e.qualifierName,e.displayedToStoredMapper),e.inline="inline",this.withQualifierElement(a,!1,e)},withItemSelect:function(e){var t=(e=e||{}).inputSourceClass||"",i=e.data||[""],s=new Element("span"),n='<select name="'+this._dataName+'" class="'+t+'">';return i.forEach((function(e){n+='<option value="'+e+'">'+e+"</option>"})),n+="</select>",s.innerHTML=n,s._getValue=this._defaultGetSelectValueFx(s),s._setValue=this._setSelectValueFx(s,e.storedToDisplayedMapper),s._addValue=this._addSelectValueFx(s,e.qualifierName,e.displayedToStoredMapper),e.inline="inline",this.withQualifierElement(s,!1,e)},withRadioList:function(e,t){var i=this,s=(t=t||{}).inputSourceClass||"",n=t.data||[],o=new Element("span"),a="<ul>";return n.forEach((function(e){var n=s+"_"+i._elementID+"_"+e;a+='<li class="term-entry"><input class="'+s+'" id="'+n+'" name="'+i._dataName+"_"+i._elementID+"_"+t.qualifierName+'" title="'+e+'" type="radio"><label for="'+n+'" title="'+e+'">'+e+"</label></li>"})),a+="</ul>",o.innerHTML=a,o.down("li.term-entry").down("input").checked=!0,o._getValue=this._getRadioValueFx(o,t.qualifierName),o._setValue=this._setRadioValueFx(o,t.storedToDisplayedMapper,e),o._addValue=this._addRadioValueFx(o,t.qualifierName,t.displayedToStoredMapper),this.withQualifierElement(o,e,t)},withTextBox:function(e,t){var i=t&&t.inputSourceClass||"",s=new Element("span");return s.innerHTML='<textarea class="qualifier-notes '+i+'" name="'+this._dataName+'"></textarea>',s._getValue=this._getTextboxValueFx(s),s._setValue=this._setTextboxValueFx(s,t.storedToDisplayedMapper,e),s._addValue=this._addTextboxValueFx(s,t.qualifierName,t.displayedToStoredMapper),this.withQualifierElement(s,e,t)},withQualifierElement:function(e,t,i){var s,n=i.defListItemClass||"",o=i.qualifierLabel||"",a=i.qualifierName||"",r=new Element("dt"),l=new Element("dd");if(r.addClassName(n),i.inline&&(r.addClassName(i.inline),l.addClassName(i.inline)),l.addClassName(n),t){r.addClassName("collapsible"),l.addClassName("collapsed"),r.insert('<span class="collapse-button">►</span>');var d=e.down("li.term-entry"),u=d&&d.down("input");s='<span class="selected-value">'+(u&&u.title||"")+"</span>",l.hide()}return r.insert("<label>"+o+"</label>"),s&&r.insert(s),l.insert(e),this._attachSummaryFx(e,r,l),this._qualifierList.insert(r).insert(l),a&&(this._qualifierMap[a]=e),this},withDeleteAction:function(){var e=new Element("span",{id:"delete_"+this._elementID,class:this._dataName+"-dialog-delete action-done clickable"}).update("✖");return this._termDetails.insert({top:e}),this._attachOnDeleteListener(e),this},attach:function(){return this._container.insert(this._termDetails),this},getDialog:function(){return this._termDetails},getID:function(){return this._elementID},getValues:function(){var e={};for(var t in this._qualifierMap)this._qualifierMap.hasOwnProperty(t)&&this._qualifierMap[t]._addValue(e);return e},setValues:function(e){if(e){for(var t in e)if(e.hasOwnProperty(t)){var i=this._qualifierMap[t];i&&i._setValue(e[t])}return this}},blur:function(){this._termDetails.hasClassName("focused")&&(this._termDetails.removeClassName("focused"),this._termDetails.addClassName("blurred"),this._toggleSummarize())},focus:function(){this._termDetails.hasClassName("focused")||(this._termDetails.removeClassName("blurred"),this._termDetails.addClassName("focused"),this._toggleSummarize())},_attachSummaryFx:function(e,t,i){var s=this;e._toggleSummarize=function(){var n=i.hasClassName("collapsed");i.visible()||t.visible()&&n?s._showSummary(t,i,e._getValue()):s._showEditable(t,i)}},_showSummary:function(e,t,i){var s,n;t.hide(),i.length>0&&"Unknown"!==i?(e.hasClassName("collapsible")&&(e.hide(),s='<dt class="'+e.className+' preview">'+e.down("label").innerHTML+"</dt>",e.insert({after:s})),n='<dd class="'+t.className+' preview">'+i+"</dd>",t.insert({after:n})):e.hide()},_showEditable:function(e,t){var i,s;e.show(),t&&!t.hasClassName("collapsed")&&t.show(),i=e.next("dt.preview"),s=t.next("dd.preview"),i&&i.remove(),s&&s.remove()},_defaultGetSelectValueFx:function(e){return function(){var t=e.down("select");return t.selectedIndex>=0?t.options[t.selectedIndex].value:""}},_setSelectValueFx:function(e,t){return function(i){e.down("select").value=t?t(i):i}},_addSelectValueFx:function(e,t,i){return function(s){var n=t||null;n&&(s[n]=i?i(e._getValue()):e._getValue())}},_getRadioValueFx:function(e,t){var i=this;return function(){return e.down('input[name="'+i._dataName+"_"+i._elementID+"_"+t+'"]:checked').title}},_setRadioValueFx:function(e,t,i){var s=this;return function(n){var o=t?t(n):n,a=e.down('input[title="'+o+'"]');if(a){a.checked=!0;var r=a.up("dd"),l=r&&r.previous("dt");l&&(s._updateLabelWithSelection(a,l),i&&s._collapseElem(l,r))}}},_addRadioValueFx:function(e,t,i){return function(s){var n=t||null;n&&(s[n]=i?i(e._getValue()):e._getValue())}},_getTextboxValueFx:function(e){return function(){return e.down("textarea").value}},_setTextboxValueFx:function(e,t,i){return function(i){e.down("textarea").value=t?t(i):i}},_addTextboxValueFx:function(e,t,i){return function(s){var n=t||null;n&&(s[n]=i?i(e.down("textarea").value):e.down("textarea").value)}},_toggleSummarize:function(){for(var e in this._qualifierMap)this._qualifierMap.hasOwnProperty(e)&&this._qualifierMap[e]._toggleSummarize()},_buildEmptyDialog:function(){this._termDetails=new Element("div",{class:"summary-item focused"}),this._termDetails.innerHTML='<input type="hidden" value="'+this._elementID+'"><div id="term_details_'+this._elementID+'" class="term-details"><dl></dl><div class="clearfloats"></div></div>',this._qualifierList=this._termDetails.down("dl"),this._attachQualifierStateChangeListener()},_attachOnDeleteListener:function(e){var t=this;e.observe("click",(function(){t._termDetails.remove(),t._qualifierMap={},Event.fire(t._container,t._dataName+":dialog:deleted",{id:t._elementID})}))},_attachQualifierStateChangeListener:function(){var e=this;this._termDetails.observe("click",(function(t){var i,s=t.target.up();s&&s.hasClassName("collapsible")?(i=s.next("dd"))&&e._toggleCollapsed(s,i):s&&s.hasClassName("term-entry")&&(i=s.up("dd"))&&e._updateLabelWithSelection(s.down("input"),i.previous("dt"))}))},_updateLabelWithSelection:function(e,t){var i=t&&t.down("span.selected-value");if(i){var s=e&&e.title||"";i.update(s),"Unknown"===s||""===s?i.removeClassName("selected"):i.addClassName("selected")}},_toggleCollapsed:function(e,t){t.hasClassName("collapsed")?this._expandElem(e,t):this._collapseElem(e,t)},_collapseElem:function(e,t){var i=e.down("span.collapse-button");t.addClassName("collapsed"),i.innerHTML="►",t.hide()},_expandElem:function(e,t){var i=e.down("span.collapse-button");t.removeClassName("collapsed"),i.innerHTML="▼",t.show()}}),e}(PhenoTips||{}))||{}),function(){var e=function(e){(e&&e.memo.elements||[$("body")]).each((function(e){e.select("input.suggestWorkgroups").each((function(e){if(!e.hasClassName("initialized")){var t={script:XWiki.contextPath+"/rest/principals/suggest?searchUsers=false",noresults:"Group not found"};new XWiki.widgets.UserPicker(e,t),e.addClassName("initialized")}}))}))};XWiki.domIsLoaded&&e()||document.observe("xwiki:dom:loaded",e),document.observe("xwiki:dom:updated",e)}();